<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/favicon.ico" />
    <!-- Preload is necessary because we show these images when we disconnect from the server,
    but at that point we cannot load these images from the server -->
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/gradient-yHQUC_QB.png" as="image" />
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/noise-60BoTA8O.png" as="image" />
    <!-- Preload the fonts -->
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/Lora-VariableFont_wght-B2ootaw-.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/PTSans-Regular-CxL0S8W7.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/PTSans-Bold-D9fedIX3.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/FiraMono-Regular-BTCkDNvf.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/FiraMono-Medium-DU3aDxX5.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/FiraMono-Bold-CLVRCuM9.ttf" as="font" crossorigin="anonymous" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta name="description" content="a marimo app" />
    <link rel="apple-touch-icon" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/apple-touch-icon.png" />
    <link rel="manifest" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/manifest.json" />

    <script data-marimo="true">
      function __resizeIframe(obj) {
        var scrollbarHeight = 20; // Max between windows, mac, and linux

        function setHeight() {
          // Guard against race condition where iframe isn't ready
          if (!obj.contentWindow?.document?.documentElement) {
            return;
          }
          var element = obj.contentWindow.document.documentElement;
          // If there is no vertical scrollbar, we don't need to resize the iframe
          if (element.scrollHeight === element.clientHeight) {
            return;
          }

          // Create a new height that includes the scrollbar height if it's visible
          var hasHorizontalScrollbar = element.scrollWidth > element.clientWidth;
          var newHeight = element.scrollHeight + (hasHorizontalScrollbar ? scrollbarHeight : 0);

          // Only update the height if it's different from the current height
          if (obj.style.height !== `${newHeight}px`) {
            obj.style.height = `${newHeight}px`;
          }
        }

        // Resize the iframe to the height of the content and bottom scrollbar height
        setHeight();

        // Resize the iframe when the content changes
        const resizeObserver = new ResizeObserver((entries) => {
          setHeight();
        });
        // Only observe if iframe content is ready
        if (obj.contentWindow?.document?.body) {
          resizeObserver.observe(obj.contentWindow.document.body);
        }
      }
    </script>
    <marimo-filename hidden>sns_publish_permissions.py</marimo-filename>
    <!-- TODO(Trevor): Legacy, required by VS Code plugin. Remove when plugin is updated (see marimo/server/_templates/template.py) -->
    <marimo-version data-version="{{ version }}" hidden></marimo-version>
    <marimo-user-config data-config="{{ user_config }}" hidden></marimo-user-config>
    <marimo-server-token data-token="{{ server_token }}" hidden></marimo-server-token>
    <!-- /TODO -->
    <title>sns publish permissions</title>
    <script type="module" crossorigin crossorigin="anonymous" src="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/index-D_l-X6Gn.js"></script>
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/preload-helper-DrOAYyMx.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/chunk-DZLz74EQ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/react-cj45iF1i.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/compiler-runtime-bbSa6V1W.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/useEventListener-B585XJK6.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/react-dom-BjyRIiB0.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/jsx-runtime-srqCRIcI.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/Combination-ChS5GBa2.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/clsx-BlAkgCmw.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/cn-BaXqCYqP.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/menu-items-C-HcgP3A.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/hotkeys-BxvS_drY.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/button-C3DbbTE3.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/dist-C8L1g4FL.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/createLucideIcon-DjFD6uqw.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/check-qhKOrN4z.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/select-C3lT2mrt.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/multi-map-D2K3AXi3.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/chevron-right-GjRGzRTx.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/dropdown-menu-BZzIne4N.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/tooltip-DPrt9GJd.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/_Uint8Array-D5Z9rM2X.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/_getTag-D4FHE--3.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/_baseIsEqual-DxkXZaQt.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/jotai-CqcPj6qO.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/invariant-L2NCWzlc.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/isArrayLikeObject-JtDUKn_v.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/merge-DfSRWBS2.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/zod-U2NFpcFA.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/utils-BaKzT0lw.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/requests-oIXZIVkS.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/once-BumILI4b.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/toDate-DvFyyQ0g.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/isSymbol-xTSywenE.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/toString-CSTolK5a.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/_baseSlice-B27Cqkm6.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/_hasUnicode-CPHpt5EV.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/useLifecycle-Rh0PP8AP.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/capitalize-C7xY7zs_.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/ai-model-dropdown-BJLAGM8G.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/badge-Czo8nniw.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/use-toast-CRhq8yNT.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/constants-BVB3VlsI.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/Deferred-CcxW2rNb.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/config-BiJechkS.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/uuid-JSI5Ub3m.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/DeferredRequestRegistry-Ccjmqswm.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/connection-9kD-dTJL.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/useNonce-DNmDtTkp.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/capabilities-DYNQ6-Fr.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/createReducer-Dmpo08fh.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/dist-BhO6Skm7.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/dist-DYRcKBTi.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/dist-nXbuW0eA.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/dist-hfg5F1cQ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/dist-BzGULjtt.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/dist-4dBKvAyu.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/dist-0fLgeFYh.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/dist-Dg2hoRfc.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/dist-BIwaxZLx.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/stex-p3EifZIQ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/cjs-Cm5h4Epc.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/_arrayReduce-DDpPg0Qh.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/type-CJyAPkYT.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/_baseProperty-CIKnF2iY.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/toNumber-B2sDWAxt.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/now-B6JN1xKT.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/debounce-DEligtiB.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/toInteger-Dibvs7y1.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/marked.esm-DI1fWf7x.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/main-CJaEi7_U.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/cells-CeDLVlyC.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/kbd-BFNVm4a_.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/renderShortcut-CeCEf8EV.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/useEvent-Cf8AdHpz.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/useDeleteCell-Bc3t2abM.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/lazy-C9W0-DeZ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/defaultLocale-6gZ00BOD.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/precisionRound-Cf6SJD9T.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/defaultLocale-UbHGVTRZ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/vega-loader.browser-DCTaBKUs.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/tooltip-Di3J3oYn.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/ErrorBoundary-DwXLP_VL.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/alert-dialog-CxCw9oQX.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/dialog-ClIOAWpQ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/useDebounce-BjCf8IUS.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/numbers-CSz2fa9C.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/SSRProvider-iPaBBhYk.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/context-CWS6NbZC.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/useNumberFormatter-8H_iASaM.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/usePress-B4wenCLd.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/input-DLOryQh1.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/ImperativeModal-ClGQ4GXE.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/cell-link-D5-sZD73.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/alert-DY4s_wkY.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/links-hfBoJmYS.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/state-D_bGND83.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/MarimoErrorOutput-ffUzGr5X.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/copy-ODI3-5mt.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/copy-CysUGjt6.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/copy-icon-BKJuA7HR.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/spinner-5y3x0_Ja.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/dist-BlRyYfZp.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/focus-KxLnFZmO.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/popover-B62m-yTZ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/useRunCells-CXTmbRd-.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/mode-Cy78x1lY.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/purify.es-BVYGX4Ma.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/RenderHTML-BdiVNqB7.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/table-C2UxG4br.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/tabs-BLJxco2q.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/add-missing-import-C21Sf8A6.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/useAsyncData-CpUo9WyH.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/useIframeCapabilities-Bl5E4Sdk.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/LazyAnyLanguageCodeMirror-CmIpJ80x.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/error-banner-Blvf_Trz.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/formats-Dr-5EPUQ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/useTheme-4lRYVxu8.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/en-US-ClM1rWQO.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/isValid-B43jkoR_.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/maps-B0oHN5Qo.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/shim-CmijwmU8.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/download-juEDJvh4.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/extends-EzlYz0hD.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/emotion-is-prop-valid.esm-D6cn-CSb.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/useDateFormatter-D2bcOLFs.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/katex-DBEwDXZO.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/dist-BY77p5Y8.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/range-CZ1Fqm86.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/table-i48JTlkp.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/Output-C35CXkvU.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/name-cell-input-Dm0PF-vI.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/useHotkey-BBy_zgts.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/dist-CQqxjtPE.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/dist-B0W-62VK.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/dist-DA4REUWb.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/dist-CTnCzwDO.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/dist-BeLp8J28.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/dist-CT07wNjy.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/dist-CcT9aH0f.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/dist-Cyd6BKf3.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/dist-D6YDRgIP.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/dist-D-fgvVNt.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/dist-D2OZ4af5.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/dist-Cep6eaBU.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/dist-CG6nuuxF.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/apl-B3qFo22I.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/asciiarmor-BeSUfcJj.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/asn1-Yuw4PYDQ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/brainfuck-ONQfYmGG.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/clike-BYwnXoSp.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/clojure-D0qS3s8l.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/cmake-DrUW7k4w.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/cobol-CTy-rAxC.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/coffeescript-DvX85jdj.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/commonlisp-rN2-4tA3.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/crystal-DH9HaNMr.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/css-BWSZbBOG.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/cypher-CN0hHtlQ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/d-CfFhByTO.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/diff-D5KX9jWB.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/dtd-CAOt54Lh.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/dylan-BRjSQyPa.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/ecl-BFmhHLwk.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/eiffel-C-yEc4lk.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/elm-D-xosfDF.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/erlang-DwS6VO1i.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/simple-mode-iIH2XKLC.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/factor-BAvqFhQd.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/forth-M-b7RVCY.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/fortran-BY42hR-9.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/gas-DUer3zP4.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/gherkin-BOmBFtxo.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/groovy-CYRk_Zq8.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/haskell-fLeayyju.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/haxe-DiJvQ3PF.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/idl-D0PcccZ6.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/javascript-oC9cmYGe.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/julia-z0xq3uqV.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/livescript-BbVvVfSY.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/lua-CtEmKXsU.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/mathematica-B-SjlQIm.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/mbox-BdnWvTJv.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/mirc-Cyycx3am.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/mllike-DSB5KObs.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/modelica-DIZcE54y.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/mscgen-MISBZbzR.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/mumps-Cnu1tNUa.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/nsis-BjqFSJO3.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/ntriples-2rre165b.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/octave-C7u5CeUZ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/oz-D5aE2uST.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/pascal-DTApZM3o.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/perl-Ckgh9LJK.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/pig-jAl9a1Kh.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/powershell-C_IKzlOl.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/properties-BdVxDpDJ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/protobuf-DLu_SUI6.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/pug-B4oU-GIl.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/puppet-CShRizHW.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/python-CV8UgSMV.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/q-D2OTJZH4.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/r-DRqIAgj1.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/rpm-BStFD27m.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/ruby-C37hkPS4.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/sas-CCEIl8BG.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/scheme-B0jflgrk.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/shell-Cq7B0hFW.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/sieve-DS0lS4kt.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/smalltalk-HHM53Uii.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/sparql-BMqtnWzI.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/stylus-Br2gMpMI.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/swift-BJ8qi_zI.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/tcl-D0knbOX7.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/textile-DrRQSuh3.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/toml-C2kDGfZi.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/troff-2dFxqWQa.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/ttcn-cfg-CBXajWEo.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/ttcn-Cj4sIofh.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/turtle-CDdPtp5F.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/vb-CtEhAMYU.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/vbscript-B0nzdgzL.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/velocity-DR7TSall.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/verilog-MmKxT9bW.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/vhdl-0jJrpQNA.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/webidl-D9f20BkN.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/xquery-B0eSGN9q.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/yacas-BS613OH9.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/z80-CJYC52xh.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/esm-DIjo4soQ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/objectWithoutPropertiesLoose-CVHckof0.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/esm-DHSHWgjO.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/trash-DVXuVt6V.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/ConsoleOutput-BatcZKPn.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/icons-CiJ1mek2.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/blob-BW6MxaEk.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/add-cell-with-ai-y1F5Z2Y5.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/chart-no-axes-column-Dr7zIwOF.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/square-function-Bn-XGt0r.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/spec-BsAvcxPB.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/useInstallPackage-DboMQFVg.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/column-preview-C1ukCxS-.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/useAddCell-BiyTaqjl.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/toggle-D5gLerI4.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/api-CpOepRkn.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/globals-CMwEtzs3.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/share-BtLtbyWB.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/dist-CjyEJrMA.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/memoize-CAcr7Wct.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/_toKey-BbfXi6wG.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/_baseSet-CAH-_bH2.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/utilities.esm-BzRjRyGG.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/floating-outline-BNbDM0Mz.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/eye-off-GfTQvjwT.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/plus-CBaILRil.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/readonly-python-code-BXa7vpHk.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/file-video-camera-Dm03euNS.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/file-text-DIapyZTO.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/file-GcyCxgZE.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/types-C9Bp8jO8.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/label-g86spPBc.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/form-DUdOrxYS.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/textarea-Cnpv5prF.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/circle-x-D7HuxVjU.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/refresh-ccw-CFRARokg.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/trash-2-CZtzD7wN.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/form-CJBhqjDq.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/field-4Jci0WvL.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/switch-C9lQcGwc.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/useBoolean-eYq94Ok6.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/useDeepCompareMemoize-EIl6UkD1.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/types-Dv1hfKnk.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/prop-types-CHCkBeAL.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/es-BEPT_zOX.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/VisuallyHidden-lvJcGOAk.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/_baseFlatten-umA55KZB.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/get-CQF_Dkll.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/hasIn-DgwLm9Ah.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/_basePickBy-DQPJpG_l.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/pick-DJvAHg2T.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/square-CCW7bjI-.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/code-xml-DKjdQj9o.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/globe--Wj1_HOr.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/send-BChAQAUR.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/refresh-cw-DEnZI2dn.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/settings-CN8Z3_-5.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/triangle-alert-BGycXz6g.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/bundle.esm-DtrWSlr6.js">
    <link rel="stylesheet" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/cells-BvrC6Bsv.css">
    <link rel="stylesheet" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/dist-CUNt1nyj.css">
    <link rel="stylesheet" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/Output-Br1mGKlI.css">
    <link rel="stylesheet" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/ConsoleOutput-BFFTcC5Y.css">
    <link rel="stylesheet" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.1/dist/assets/index-xc2Ie6gg.css">
  
<script data-marimo="true">
    window.__MARIMO_STATIC__ = {};
    window.__MARIMO_STATIC__.files = {};
</script>
</head>
  <body>
    <div id="root"></div>
    <!-- This is a portal for the data editor to render in -->
    <div id="portal" data-testid="glide-portal" style="position: fixed; left: 0; top: 0; z-index: 9999"></div>
    <script data-marimo="true">
      window.__MARIMO_MOUNT_CONFIG__ = {
            "filename": "sns_publish_permissions.py",
            "mode": "read",
            "version": "0.18.1",
            "serverToken": "static",
            "config": {"ai": {"models": {"custom_models": [], "displayed_models": []}}, "completion": {"activate_on_typing": true, "copilot": false}, "diagnostics": {"sql_linter": true}, "display": {"cell_output": "below", "code_editor_font_size": 14, "dataframes": "rich", "default_table_max_columns": 50, "default_table_page_size": 10, "default_width": "medium", "reference_highlighting": false, "theme": "light"}, "formatting": {"line_length": 79}, "keymap": {"overrides": {}, "preset": "default"}, "language_servers": {"pylsp": {"enable_flake8": false, "enable_mypy": true, "enable_pydocstyle": false, "enable_pyflakes": false, "enable_pylint": false, "enable_ruff": true, "enabled": false}}, "mcp": {"mcpServers": {}, "presets": []}, "package_management": {"manager": "pip"}, "runtime": {"auto_instantiate": false, "auto_reload": "off", "default_sql_output": "auto", "on_cell_change": "autorun", "output_max_bytes": 8000000, "reactive_tests": true, "std_stream_max_bytes": 1000000, "watcher_on_save": "lazy"}, "save": {"autosave": "after_delay", "autosave_delay": 1000, "format_on_save": false}, "server": {"browser": "default", "follow_symlink": false}, "snippets": {"custom_paths": [], "include_default_snippets": true}},
            "configOverrides": {},
            "appConfig": {"sql_output": "auto", "width": "medium"},
            "view": {"showAppCode": true},
            "notebook": {"cells": [{"code": "import marimo as mo", "code_hash": "1d0db38904205bec4d6f6f6a1f6cec3e", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "Hbol", "name": "_"}, {"code": "mo.md(r\"\"\"\n# SNS Publish Permissions\n\"\"\")", "code_hash": "30e46cddeb9dd125ba6607f7a17fc47a", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "MJUe", "name": "_"}, {"code": "mo.md(r\"\"\"\nWhen Bad Thing happens, aws puts an event onto our event bus.\nWe have an eventbridge rule to publish the event to an sns topic so that we get emailed.\nBut no email arrived.\nHow come?\n\nThe rule's metrics show a failed invocation.\nSo the event was emitted and matched the rule,\nbut the rule failed to publish to the topic.\n\nWe have a cloudwatch alarm which publishes to that topic too.\nWe _do_ get emails when the alarm goes off.\nSo the alarm is working as expected but not the rule.\n\nWe set up the alarm and the rule via cdk.\nWe import the topic, created elsewhere, into the stack via the `from_topic_arn` method.\nWe configure the rule to publish to the topic via the `Rule` construct's `add_target` method.\nWe configure the alarm to publish to the topic via the `Alarm` construct's `add_alarm_action` method.\nSimilar, yet the alarm works and the rule doesn't.\n\nMaybe a permissions issue?\nDoes it matter that the topic was imported, not created?\nWhat are the default permissions?\nHow do the cdk methods modify them?\n\nI'll investigate using a simple stack.\n\"\"\")", "code_hash": "4cefed35ee92fd8984ea2421b0043436", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "vblA", "name": "_"}, {"code": "mo.md(r\"\"\"\n## Stack\n\"\"\")", "code_hash": "68d9515abac7840cdc46d7808fd6dedf", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "bkHC", "name": "_"}, {"code": "mo.mermaid(\n    \"\"\"\ngraph LR\n    Z1:::hidden --\u003E|invoking| A[noop \u03bb]\n    A --\u003E|triggers| B[alarm]\n    B --\u003E|publishes to| C[pre-existing topic]\n    C --\u003E|invokes| D[target \u03bb]\n\n    Z2:::hidden --\u003E|putting| E[event] \n    E --\u003E|matches| F[rule]\n    F --\u003E|publishes to| G[topic]\n    G --\u003E|invokes| H[target \u03bb]\n\n    B --\u003E|publishes to| G\n    F --\u003E|publishes to| C\n\n\"\"\"\n)", "code_hash": "bbbfe8f9c71fe95bcd2db0f08c81e764", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "lEQa", "name": "_"}, {"code": "mo.md(r\"\"\"\n## Investigation\n\"\"\")", "code_hash": "9a772d95030c40122a70312309d3c705", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "PKri", "name": "_"}, {"code": "from datetime import datetime, timezone\n\nimport boto3\n\nlambda_ = boto3.client(\"lambda\")\nevents = boto3.client(\"events\")", "code_hash": "870d5f337002e62142074ed06fb0ce6d", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "Xref", "name": "_"}, {"code": "start_time = datetime.now(timezone.utc)\ninvoke_response = lambda_.invoke(FunctionName=\"noop\")\nput_events_response = events.put_events(\n    Entries=[\n        {\n            \"Source\": \"my_source\",\n            \"DetailType\": \"my_detail_type\",\n            \"Detail\": \"{}\",\n        },\n    ]\n)", "code_hash": "b5a427d125886eb13db0378e1834b3a1", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "SFPL", "name": "_"}, {"code": "start_time", "code_hash": "c4d98dbd5badae901761ab6422fa3e70", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "BYtC", "name": "_"}, {"code": "assert invoke_response[\"StatusCode\"] == 200", "code_hash": "2714a11898a7237f08713eafb2f41fd1", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "RGSE", "name": "_"}, {"code": "assert put_events_response[\"FailedEntryCount\"] == 0", "code_hash": "6bdb61c430d3f8e8b3bb9f8a6d26a399", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "Kclp", "name": "_"}, {"code": "mo.md(r\"\"\"\nWhich topics did the alarm and rule successfully publish to?\nWe'll wait a bit then check the target lambdas.\n\"\"\")", "code_hash": "7c5da1009da80a978e8a590f2f39a7fc", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "emfo", "name": "_"}, {"code": "import time\n\ntime.sleep(4 * 60)", "code_hash": "a4156b25c8569401810f45dbe8f8ce8f", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "Hstk", "name": "_"}, {"code": "cloudwatch = boto3.client(\"cloudwatch\")", "code_hash": "0b545916c10a3c336c49e2eff35ca378", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "nWHF", "name": "_"}, {"code": "cloudwatch.get_metric_statistics(\n    MetricName=\"Invocations\",\n    Namespace=\"AWS/Lambda\",\n    Dimensions=[{\"Name\": \"FunctionName\", \"Value\": \"pre_existing_topic_target\"}],\n    StartTime=start_time,\n    EndTime=datetime.now(timezone.utc),\n    Statistics=[\"Sum\"],\n    Period=60,\n)[\"Datapoints\"]", "code_hash": "698ce9fe61a27ca1a9ca26fbbee0b908", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "iLit", "name": "_"}, {"code": "cloudwatch.get_metric_statistics(\n    MetricName=\"Invocations\",\n    Namespace=\"AWS/Lambda\",\n    Dimensions=[{\"Name\": \"FunctionName\", \"Value\": \"topic_target\"}],\n    StartTime=start_time,\n    EndTime=datetime.now(timezone.utc),\n    Statistics=[\"Sum\"],\n    Period=60,\n)[\"Datapoints\"]", "code_hash": "7a38f480e70c8ec0fd35e97319648298", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "ZHCJ", "name": "_"}, {"code": "mo.md(r\"\"\"\nFor the pre-existing topic and for the new topic, one publish succeeded and the other failed. Which?\n\"\"\")", "code_hash": "29ec78c3b019e0d519bab6bd87f1bef2", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "ROlb", "name": "_"}, {"code": "cloudwatch.describe_alarm_history(\n    StartDate=start_time,\n    EndDate=datetime.now(timezone.utc),\n    AlarmName=\"noop_lambda_invocation_alarm\",\n)[\"AlarmHistoryItems\"]", "code_hash": "98231dbdb1792614b3545fcec198cfe1", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "qnkX", "name": "_"}, {"code": "mo.md(r\"\"\"\nCloudwatch published ok to the pre-existing topic but failed to publish to the new topic because\n\n\u003E CloudWatch Alarms is not authorized to perform: SNS:Publish on resource:arn:aws:sns:eu-west-2:872115063659:my_topic\n\nThat means eventbridge published ok to the new topic but not to the pre-existing topic.\n\nWhat are the topic permissions?\n\"\"\")", "code_hash": "eaeddb4dd0eac8a22d8dd1c2cb5549f3", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "TqIu", "name": "_"}, {"code": "import json\nfrom os import environ\n\nsns = boto3.client(\"sns\")", "code_hash": "038287e7fe69a7a9aaae5cbe18034433", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "Vxnm", "name": "_"}, {"code": "_ = sns.get_topic_attributes(TopicArn=f\"arn:aws:sns:{environ['REGION']}:{environ['ACCOUNT_ID']}:pre_existing_topic\")\njson.loads(_[\"Attributes\"][\"Policy\"])", "code_hash": "7f81463c8b09b80e5e7280cca0a25604", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "DnEU", "name": "_"}, {"code": "mo.md(r\"\"\"\nBased on the `Id`, this must be a topic's default access policy.\n\nAnd it must be that cloudwatch satisfies the `AWS:SourceOwner` condition and eventbridge doesn't.\n\"\"\")", "code_hash": "f1d99d96a3c498730418e69f39e4f849", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "ulZA", "name": "_"}, {"code": "_ = sns.get_topic_attributes(TopicArn=f\"arn:aws:sns:{environ['REGION']}:{environ['ACCOUNT_ID']}:my_topic\")\njson.loads(_[\"Attributes\"][\"Policy\"])", "code_hash": "572ebf79b4aa74543a9795bad49e20c3", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "ecfG", "name": "_"}, {"code": "mo.md(r\"\"\"\nOk, that's clear: eventbridge has permission to publish to the new topic and cloudwatch does not.\n\"\"\")", "code_hash": "2c7b802dd044f01a4f38e06c550a010b", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "Pvdt", "name": "_"}, {"code": "mo.md(r\"\"\"\nHow come these permissions?\nHere's what I think has happened.\n\nI created the new topic in the stack,\nand added subscriptions via `add_target` and `add_alarm_action`.\n`add_target` modifies the access policy, permitting eventbridge.\nBut `add_alarm_action` does not:\nyou have to give cloudwatch permission yourself.\nThat's the **first surprise**.\n\nThe **second surprise** is that `add_target` doesn't add permissions\non top of the default `AWS:SourceOwner` policy.\nInstead, it replaces the default policy.\nThe docs make this clear for `add_to_resource_policy`:\n\n\u003E If this topic was created in this stack (`new Topic`), a topic policy will be automatically created upon the first call to `addToResourcePolicy`.\n\nand I suppose it's implicit that the same applies to other permissions-changing methods,\nsuch as `add_target`.\n\nI created the pre-existing topic in another stack, with all defaults.\nIt has the default policy based on `AWS:SourceOwner`.\nI imported the topic into the stack via `from_topic_arn`,\nthen added subscriptions via `add_target` and `add_alarm_action`.\nBecause the topic was imported,\nneither method changed the access policy.\nBut \u2014 **third surprise** \u2014 cloudwatch passes the policy and events doesn't.\n\nA **fourth surprise**.\nIt makes sense that the cdk methods didn't change the pre-existing topic's policy.\nIt would be confusing if stacks could modify resources they didn't create.\nExcept sometimes they do!\nFor example, in our stack we _were_ able to add the target lambda subscription to the pre-existing topic.\nSo cdk _doesn't_ strictly observe the \"stacks can't modify resources they didn't create\" rule.\n\"\"\")", "code_hash": "8bfbcf11cc0919f34164612ef04c3470", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "ZBYS", "name": "_"}, {"code": "mo.md(r\"\"\"\n## References\n\n[1] https://docs.aws.amazon.com/sns/latest/dg/sns-access-policy-use-cases.html#sns-allow-specified-service-to-publish-to-topic\n\nConfirms that cloudwatch supports `AWS:SourceOwner` and eventbridge does not.\n\nWarns that\n\n\u003E `aws:SourceOwner` is deprecated and new services can integrate with Amazon SNS\n\u003E only through `aws:SourceArn` and `aws:SourceAccount`.\n\u003E Amazon SNS still maintains backward compatibility for existing services\n\u003E that are currently supporting `aws:SourceOwner`.\n\n\"Maintains backward compatibility\" seems to go as far as using `aws:SourceOwner` in the default policy.\n\n[2] https://github.com/awsdocs/iam-user-guide/issues/111\n\nAWS say they're not going to document `SourceOwner` because deprecated.\nOk, but then, as one of the comments says, why keep using it in the default policy?\n\n[3] https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_sns/Topic.html#aws_cdk.aws_sns.Topic.add_to_resource_policy\n\"\"\")", "code_hash": "8b01628cd021a679adeaf53aca24cf0a", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "aLJB", "name": "_"}], "metadata": {"marimo_version": "0.18.1"}, "version": "1"},
            "session": {"cells": [{"code_hash": "1d0db38904205bec4d6f6f6a1f6cec3e", "console": [], "id": "Hbol", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "30e46cddeb9dd125ba6607f7a17fc47a", "console": [], "id": "MJUe", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch1 id=\"sns-publish-permissions\"\u003ESNS Publish Permissions\u003C/h1\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "4cefed35ee92fd8984ea2421b0043436", "console": [], "id": "vblA", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003EWhen Bad Thing happens, aws puts an event onto our event bus.\nWe have an eventbridge rule to publish the event to an sns topic so that we get emailed.\nBut no email arrived.\nHow come?\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EThe rule's metrics show a failed invocation.\nSo the event was emitted and matched the rule,\nbut the rule failed to publish to the topic.\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EWe have a cloudwatch alarm which publishes to that topic too.\nWe \u003Cem\u003Edo\u003C/em\u003E get emails when the alarm goes off.\nSo the alarm is working as expected but not the rule.\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EWe set up the alarm and the rule via cdk.\nWe import the topic, created elsewhere, into the stack via the \u003Ccode\u003Efrom_topic_arn\u003C/code\u003E method.\nWe configure the rule to publish to the topic via the \u003Ccode\u003ERule\u003C/code\u003E construct's \u003Ccode\u003Eadd_target\u003C/code\u003E method.\nWe configure the alarm to publish to the topic via the \u003Ccode\u003EAlarm\u003C/code\u003E construct's \u003Ccode\u003Eadd_alarm_action\u003C/code\u003E method.\nSimilar, yet the alarm works and the rule doesn't.\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EMaybe a permissions issue?\nDoes it matter that the topic was imported, not created?\nWhat are the default permissions?\nHow do the cdk methods modify them?\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EI'll investigate using a simple stack.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "68d9515abac7840cdc46d7808fd6dedf", "console": [], "id": "bkHC", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch2 id=\"stack\"\u003EStack\u003C/h2\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "bbbfe8f9c71fe95bcd2db0f08c81e764", "console": [], "id": "lEQa", "outputs": [{"data": {"text/html": "\u003Cmarimo-mermaid data-diagram='\u0026quot;\u0026#92;ngraph LR\u0026#92;n    Z1:::hidden --\u0026gt;|invoking| A[noop \u03bb]\u0026#92;n    A --\u0026gt;|triggers| B[alarm]\u0026#92;n    B --\u0026gt;|publishes to| C[pre-existing topic]\u0026#92;n    C --\u0026gt;|invokes| D[target \u03bb]\u0026#92;n\u0026#92;n    Z2:::hidden --\u0026gt;|putting| E[event] \u0026#92;n    E --\u0026gt;|matches| F[rule]\u0026#92;n    F --\u0026gt;|publishes to| G[topic]\u0026#92;n    G --\u0026gt;|invokes| H[target \u03bb]\u0026#92;n\u0026#92;n    B --\u0026gt;|publishes to| G\u0026#92;n    F --\u0026gt;|publishes to| C\u0026#92;n\u0026#92;n\u0026quot;'\u003E\u003C/marimo-mermaid\u003E"}, "type": "data"}]}, {"code_hash": "9a772d95030c40122a70312309d3c705", "console": [], "id": "PKri", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch2 id=\"investigation\"\u003EInvestigation\u003C/h2\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "870d5f337002e62142074ed06fb0ce6d", "console": [], "id": "Xref", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "b5a427d125886eb13db0378e1834b3a1", "console": [], "id": "SFPL", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "c4d98dbd5badae901761ab6422fa3e70", "console": [], "id": "BYtC", "outputs": [{"data": {"text/html": "\u003Cpre class='text-xs'\u003Edatetime.datetime(2025, 12, 5, 14, 41, 55, 670041, tzinfo=datetime.timezone.utc)\u003C/pre\u003E"}, "type": "data"}]}, {"code_hash": "2714a11898a7237f08713eafb2f41fd1", "console": [], "id": "RGSE", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "6bdb61c430d3f8e8b3bb9f8a6d26a399", "console": [], "id": "Kclp", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "7c5da1009da80a978e8a590f2f39a7fc", "console": [], "id": "emfo", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003EWhich topics did the alarm and rule successfully publish to?\nWe'll wait a bit then check the target lambdas.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "a4156b25c8569401810f45dbe8f8ce8f", "console": [], "id": "Hstk", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "0b545916c10a3c336c49e2eff35ca378", "console": [], "id": "nWHF", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "698ce9fe61a27ca1a9ca26fbbee0b908", "console": [], "id": "iLit", "outputs": [{"data": {"application/json": "[{\"Timestamp\": \"text/plain:2025-12-05 14:43:00+00:00\", \"Sum\": \"text/plain+float:1.0\", \"Unit\": \"Count\"}]"}, "type": "data"}]}, {"code_hash": "7a38f480e70c8ec0fd35e97319648298", "console": [], "id": "ZHCJ", "outputs": [{"data": {"application/json": "[{\"Timestamp\": \"text/plain:2025-12-05 14:41:00+00:00\", \"Sum\": \"text/plain+float:1.0\", \"Unit\": \"Count\"}]"}, "type": "data"}]}, {"code_hash": "29ec78c3b019e0d519bab6bd87f1bef2", "console": [], "id": "ROlb", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003EFor the pre-existing topic and for the new topic, one publish succeeded and the other failed. Which?\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "98231dbdb1792614b3545fcec198cfe1", "console": [], "id": "qnkX", "outputs": [{"data": {"application/json": "[{\"AlarmName\": \"noop_lambda_invocation_alarm\", \"AlarmType\": \"MetricAlarm\", \"Timestamp\": \"text/plain:2025-12-05 14:43:26.088000+00:00\", \"HistoryItemType\": \"Action\", \"HistorySummary\": \"Failed to execute action arn:aws:sns:eu-west-2:872115063659:my_topic\", \"HistoryData\": \"{\\\"actionState\\\":\\\"Failed\\\",\\\"stateUpdateTimestamp\\\":1764945806020,\\\"notificationResource\\\":\\\"arn:aws:sns:eu-west-2:872115063659:my_topic\\\",\\\"publishedMessage\\\":null,\\\"error\\\":\\\"CloudWatch Alarms is not authorized to perform: SNS:Publish on resource:arn:aws:sns:eu-west-2:872115063659:my_topic\\\"}\"}, {\"AlarmName\": \"noop_lambda_invocation_alarm\", \"AlarmType\": \"MetricAlarm\", \"Timestamp\": \"text/plain:2025-12-05 14:43:26.068000+00:00\", \"HistoryItemType\": \"Action\", \"HistorySummary\": \"Successfully executed action arn:aws:sns:eu-west-2:872115063659:pre_existing_topic\", \"HistoryData\": \"{\\\"actionState\\\":\\\"Succeeded\\\",\\\"stateUpdateTimestamp\\\":1764945806020,\\\"notificationResource\\\":\\\"arn:aws:sns:eu-west-2:872115063659:pre_existing_topic\\\",\\\"publishedMessage\\\":\\\"{\\\\\\\"default\\\\\\\":\\\\\\\"{\\\\\\\\\\\\\\\"AlarmName\\\\\\\\\\\\\\\":\\\\\\\\\\\\\\\"noop_lambda_invocation_alarm\\\\\\\\\\\\\\\",\\\\\\\\\\\\\\\"AlarmDescription\\\\\\\\\\\\\\\":null,\\\\\\\\\\\\\\\"AWSAccountId\\\\\\\\\\\\\\\":\\\\\\\\\\\\\\\"872115063659\\\\\\\\\\\\\\\",\\\\\\\\\\\\\\\"AlarmConfigurationUpdatedTimestamp\\\\\\\\\\\\\\\":\\\\\\\\\\\\\\\"2025-11-17T20:57:01.317+0000\\\\\\\\\\\\\\\",\\\\\\\\\\\\\\\"NewStateValue\\\\\\\\\\\\\\\":\\\\\\\\\\\\\\\"ALARM\\\\\\\\\\\\\\\",\\\\\\\\\\\\\\\"NewStateReason\\\\\\\\\\\\\\\":\\\\\\\\\\\\\\\"Threshold Crossed: 1 datapoint [1.0 (05/12/25 14:41:00)] was greater than or equal to the threshold (1.0).\\\\\\\\\\\\\\\",\\\\\\\\\\\\\\\"StateChangeTime\\\\\\\\\\\\\\\":\\\\\\\\\\\\\\\"2025-12-05T14:43:26.020+0000\\\\\\\\\\\\\\\",\\\\\\\\\\\\\\\"Region\\\\\\\\\\\\\\\":\\\\\\\\\\\\\\\"EU (London)\\\\\\\\\\\\\\\",\\\\\\\\\\\\\\\"AlarmArn\\\\\\\\\\\\\\\":\\\\\\\\\\\\\\\"arn:aws:cloudwatch:eu-west-2:872115063659:alarm:noop_lambda_invocation_alarm\\\\\\\\\\\\\\\",\\\\\\\\\\\\\\\"OldStateValue\\\\\\\\\\\\\\\":\\\\\\\\\\\\\\\"INSUFFICIENT_DATA\\\\\\\\\\\\\\\",\\\\\\\\\\\\\\\"OKActions\\\\\\\\\\\\\\\":[],\\\\\\\\\\\\\\\"AlarmActions\\\\\\\\\\\\\\\":[\\\\\\\\\\\\\\\"arn:aws:sns:eu-west-2:872115063659:pre_existing_topic\\\\\\\\\\\\\\\",\\\\\\\\\\\\\\\"arn:aws:sns:eu-west-2:872115063659:my_topic\\\\\\\\\\\\\\\"],\\\\\\\\\\\\\\\"InsufficientDataActions\\\\\\\\\\\\\\\":[],\\\\\\\\\\\\\\\"Trigger\\\\\\\\\\\\\\\":{\\\\\\\\\\\\\\\"MetricName\\\\\\\\\\\\\\\":\\\\\\\\\\\\\\\"Invocations\\\\\\\\\\\\\\\",\\\\\\\\\\\\\\\"Namespace\\\\\\\\\\\\\\\":\\\\\\\\\\\\\\\"AWS/Lambda\\\\\\\\\\\\\\\",\\\\\\\\\\\\\\\"StatisticType\\\\\\\\\\\\\\\":\\\\\\\\\\\\\\\"Statistic\\\\\\\\\\\\\\\",\\\\\\\\\\\\\\\"Statistic\\\\\\\\\\\\\\\":\\\\\\\\\\\\\\\"SUM\\\\\\\\\\\\\\\",\\\\\\\\\\\\\\\"Unit\\\\\\\\\\\\\\\":null,\\\\\\\\\\\\\\\"Dimensions\\\\\\\\\\\\\\\":[{\\\\\\\\\\\\\\\"value\\\\\\\\\\\\\\\":\\\\\\\\\\\\\\\"noop\\\\\\\\\\\\\\\",\\\\\\\\\\\\\\\"name\\\\\\\\\\\\\\\":\\\\\\\\\\\\\\\"FunctionName\\\\\\\\\\\\\\\"}],\\\\\\\\\\\\\\\"Period\\\\\\\\\\\\\\\":60,\\\\\\\\\\\\\\\"EvaluationPeriods\\\\\\\\\\\\\\\":1,\\\\\\\\\\\\\\\"ComparisonOperator\\\\\\\\\\\\\\\":\\\\\\\\\\\\\\\"GreaterThanOrEqualToThreshold\\\\\\\\\\\\\\\",\\\\\\\\\\\\\\\"Threshold\\\\\\\\\\\\\\\":1.0,\\\\\\\\\\\\\\\"TreatMissingData\\\\\\\\\\\\\\\":\\\\\\\\\\\\\\\"\\\\\\\\\\\\\\\",\\\\\\\\\\\\\\\"EvaluateLowSampleCountPercentile\\\\\\\\\\\\\\\":\\\\\\\\\\\\\\\"\\\\\\\\\\\\\\\"}}\\\\\\\",\\\\\\\"sms\\\\\\\":\\\\\\\"ALARM: \\\\\\\\\\\\\\\"noop_lambda_invocation_alarm\\\\\\\\\\\\\\\" in EU (London)\\\\\\\",\\\\\\\"email\\\\\\\":\\\\\\\"You are receiving this email because your Amazon CloudWatch Alarm \\\\\\\\\\\\\\\"noop_lambda_invocation_alarm\\\\\\\\\\\\\\\" in the EU (London) region has entered the ALARM state, because \\\\\\\\\\\\\\\"Threshold Crossed: 1 datapoint [1.0 (05/12/25 14:41:00)] was greater than or equal to the threshold (1.0).\\\\\\\\\\\\\\\" at \\\\\\\\\\\\\\\"Friday 05 December, 2025 14:43:26 UTC\\\\\\\\\\\\\\\".\\\\\\\\n\\\\\\\\nView this alarm in the AWS Management Console:\\\\\\\\nhttps://eu-west-2.console.aws.amazon.com/cloudwatch/deeplink.js?region=eu-west-2#alarmsV2:alarm/noop_lambda_invocation_alarm\\\\\\\\n\\\\\\\\nAlarm Details:\\\\\\\\n- Name:                       noop_lambda_invocation_alarm\\\\\\\\n- Description:                \\\\\\\\n- State Change:               INSUFFICIENT_DATA -\u003E ALARM\\\\\\\\n- Reason for State Change:    Threshold Crossed: 1 datapoint [1.0 (05/12/25 14:41:00)] was greater than or equal to the threshold (1.0).\\\\\\\\n- Timestamp:                  Friday 05 December, 2025 14:43:26 UTC\\\\\\\\n- AWS Account:                872115063659\\\\\\\\n- Alarm Arn:                  arn:aws:cloudwatch:eu-west-2:872115063659:alarm:noop_lambda_invocation_alarm\\\\\\\\n\\\\\\\\nThreshold:\\\\\\\\n- The alarm is in the ALARM state when the metric is GreaterThanOrEqualToThreshold 1.0 for at least 1 of the last 1 period(s) of 60 seconds. \\\\\\\\n\\\\\\\\nMonitored Metric:\\\\\\\\n- MetricNamespace:                     AWS/Lambda\\\\\\\\n- MetricName:                          Invocations\\\\\\\\n- Dimensions:                          [FunctionName = noop]\\\\\\\\n- Period:                              60 seconds\\\\\\\\n- Statistic:                           Sum\\\\\\\\n- Unit:                                not specified\\\\\\\\n\\\\\\\\n\\\\\\\\n\\\\\\\\nState Change Actions:\\\\\\\\n- OK: \\\\\\\\n- ALARM: [arn:aws:sns:eu-west-2:872115063659:pre_existing_topic] [arn:aws:sns:eu-west-2:872115063659:my_topic]\\\\\\\\n- INSUFFICIENT_DATA: \\\\\\\\n\\\\\\\"}\\\",\\\"error\\\":null}\"}, {\"AlarmName\": \"noop_lambda_invocation_alarm\", \"AlarmType\": \"MetricAlarm\", \"Timestamp\": \"text/plain:2025-12-05 14:43:26.020000+00:00\", \"HistoryItemType\": \"StateUpdate\", \"HistorySummary\": \"Alarm updated from INSUFFICIENT_DATA to ALARM\", \"HistoryData\": \"{\\\"version\\\":\\\"1.0\\\",\\\"oldState\\\":{\\\"stateValue\\\":\\\"INSUFFICIENT_DATA\\\",\\\"stateReason\\\":\\\"Insufficient Data: 1 datapoint was unknown.\\\",\\\"stateReasonData\\\":{\\\"version\\\":\\\"1.0\\\",\\\"queryDate\\\":\\\"2025-12-05T14:18:26.018+0000\\\",\\\"statistic\\\":\\\"Sum\\\",\\\"period\\\":60,\\\"recentDatapoints\\\":[],\\\"threshold\\\":1.0,\\\"evaluatedDatapoints\\\":[{\\\"timestamp\\\":\\\"2025-12-05T14:17:00.000+0000\\\"}]}},\\\"newState\\\":{\\\"stateValue\\\":\\\"ALARM\\\",\\\"stateReason\\\":\\\"Threshold Crossed: 1 datapoint [1.0 (05/12/25 14:41:00)] was greater than or equal to the threshold (1.0).\\\",\\\"stateReasonData\\\":{\\\"version\\\":\\\"1.0\\\",\\\"queryDate\\\":\\\"2025-12-05T14:43:26.018+0000\\\",\\\"startDate\\\":\\\"2025-12-05T14:41:00.000+0000\\\",\\\"statistic\\\":\\\"Sum\\\",\\\"period\\\":60,\\\"recentDatapoints\\\":[1.0],\\\"threshold\\\":1.0,\\\"evaluatedDatapoints\\\":[{\\\"timestamp\\\":\\\"2025-12-05T14:41:00.000+0000\\\",\\\"sampleCount\\\":1.0,\\\"value\\\":1.0}]}}}\"}]"}, "type": "data"}]}, {"code_hash": "eaeddb4dd0eac8a22d8dd1c2cb5549f3", "console": [], "id": "TqIu", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003ECloudwatch published ok to the pre-existing topic but failed to publish to the new topic because\u003C/span\u003E\n\u003Cblockquote\u003E\n\u003Cspan class=\"paragraph\"\u003ECloudWatch Alarms is not authorized to perform: SNS:Publish on resource:arn:aws:sns:eu-west-2:872115063659:my_topic\u003C/span\u003E\n\u003C/blockquote\u003E\n\u003Cspan class=\"paragraph\"\u003EThat means eventbridge published ok to the new topic but not to the pre-existing topic.\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EWhat are the topic permissions?\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "038287e7fe69a7a9aaae5cbe18034433", "console": [], "id": "Vxnm", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "7f81463c8b09b80e5e7280cca0a25604", "console": [], "id": "DnEU", "outputs": [{"data": {"application/json": "{\"Version\": \"2008-10-17\", \"Id\": \"__default_policy_ID\", \"Statement\": [{\"Sid\": \"__default_statement_ID\", \"Effect\": \"Allow\", \"Principal\": {\"AWS\": \"*\"}, \"Action\": [\"SNS:Publish\", \"SNS:RemovePermission\", \"SNS:SetTopicAttributes\", \"SNS:DeleteTopic\", \"SNS:ListSubscriptionsByTopic\", \"SNS:GetTopicAttributes\", \"SNS:AddPermission\", \"SNS:Subscribe\"], \"Resource\": \"arn:aws:sns:eu-west-2:872115063659:pre_existing_topic\", \"Condition\": {\"StringEquals\": {\"AWS:SourceOwner\": \"872115063659\"}}}]}"}, "type": "data"}]}, {"code_hash": "f1d99d96a3c498730418e69f39e4f849", "console": [], "id": "ulZA", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003EBased on the \u003Ccode\u003EId\u003C/code\u003E, this must be a topic's default access policy.\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EAnd it must be that cloudwatch satisfies the \u003Ccode\u003EAWS:SourceOwner\u003C/code\u003E condition and eventbridge doesn't.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "572ebf79b4aa74543a9795bad49e20c3", "console": [], "id": "ecfG", "outputs": [{"data": {"application/json": "{\"Version\": \"2012-10-17\", \"Statement\": [{\"Sid\": \"0\", \"Effect\": \"Allow\", \"Principal\": {\"Service\": \"events.amazonaws.com\"}, \"Action\": \"sns:Publish\", \"Resource\": \"arn:aws:sns:eu-west-2:872115063659:my_topic\"}]}"}, "type": "data"}]}, {"code_hash": "2c7b802dd044f01a4f38e06c550a010b", "console": [], "id": "Pvdt", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003EOk, that's clear: eventbridge has permission to publish to the new topic and cloudwatch does not.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "8bfbcf11cc0919f34164612ef04c3470", "console": [], "id": "ZBYS", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003EHow come these permissions?\nHere's what I think has happened.\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EI created the new topic in the stack,\nand added subscriptions via \u003Ccode\u003Eadd_target\u003C/code\u003E and \u003Ccode\u003Eadd_alarm_action\u003C/code\u003E.\n\u003Ccode\u003Eadd_target\u003C/code\u003E modifies the access policy, permitting eventbridge.\nBut \u003Ccode\u003Eadd_alarm_action\u003C/code\u003E does not:\nyou have to give cloudwatch permission yourself.\nThat's the \u003Cstrong\u003Efirst surprise\u003C/strong\u003E.\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EThe \u003Cstrong\u003Esecond surprise\u003C/strong\u003E is that \u003Ccode\u003Eadd_target\u003C/code\u003E doesn't add permissions\non top of the default \u003Ccode\u003EAWS:SourceOwner\u003C/code\u003E policy.\nInstead, it replaces the default policy.\nThe docs make this clear for \u003Ccode\u003Eadd_to_resource_policy\u003C/code\u003E:\u003C/span\u003E\n\u003Cblockquote\u003E\n\u003Cspan class=\"paragraph\"\u003EIf this topic was created in this stack (\u003Ccode\u003Enew Topic\u003C/code\u003E), a topic policy will be automatically created upon the first call to \u003Ccode\u003EaddToResourcePolicy\u003C/code\u003E.\u003C/span\u003E\n\u003C/blockquote\u003E\n\u003Cspan class=\"paragraph\"\u003Eand I suppose it's implicit that the same applies to other permissions-changing methods,\nsuch as \u003Ccode\u003Eadd_target\u003C/code\u003E.\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EI created the pre-existing topic in another stack, with all defaults.\nIt has the default policy based on \u003Ccode\u003EAWS:SourceOwner\u003C/code\u003E.\nI imported the topic into the stack via \u003Ccode\u003Efrom_topic_arn\u003C/code\u003E,\nthen added subscriptions via \u003Ccode\u003Eadd_target\u003C/code\u003E and \u003Ccode\u003Eadd_alarm_action\u003C/code\u003E.\nBecause the topic was imported,\nneither method changed the access policy.\nBut \u2014 \u003Cstrong\u003Ethird surprise\u003C/strong\u003E \u2014 cloudwatch passes the policy and events doesn't.\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EA \u003Cstrong\u003Efourth surprise\u003C/strong\u003E.\nIt makes sense that the cdk methods didn't change the pre-existing topic's policy.\nIt would be confusing if stacks could modify resources they didn't create.\nExcept sometimes they do!\nFor example, in our stack we \u003Cem\u003Ewere\u003C/em\u003E able to add the target lambda subscription to the pre-existing topic.\nSo cdk \u003Cem\u003Edoesn't\u003C/em\u003E strictly observe the \"stacks can't modify resources they didn't create\" rule.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "8b01628cd021a679adeaf53aca24cf0a", "console": [], "id": "aLJB", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch2 id=\"references\"\u003EReferences\u003C/h2\u003E\n\u003Cspan class=\"paragraph\"\u003E[1] \u003Ca href=\"https://docs.aws.amazon.com/sns/latest/dg/sns-access-policy-use-cases.html#sns-allow-specified-service-to-publish-to-topic\" rel=\"noopener\" target=\"_blank\"\u003Ehttps://docs.aws.amazon.com/sns/latest/dg/sns-access-policy-use-cases.html#sns-allow-specified-service-to-publish-to-topic\u003C/a\u003E\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EConfirms that cloudwatch supports \u003Ccode\u003EAWS:SourceOwner\u003C/code\u003E and eventbridge does not.\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EWarns that\u003C/span\u003E\n\u003Cblockquote\u003E\n\u003Cspan class=\"paragraph\"\u003E\u003Ccode\u003Eaws:SourceOwner\u003C/code\u003E is deprecated and new services can integrate with Amazon SNS\nonly through \u003Ccode\u003Eaws:SourceArn\u003C/code\u003E and \u003Ccode\u003Eaws:SourceAccount\u003C/code\u003E.\nAmazon SNS still maintains backward compatibility for existing services\nthat are currently supporting \u003Ccode\u003Eaws:SourceOwner\u003C/code\u003E.\u003C/span\u003E\n\u003C/blockquote\u003E\n\u003Cspan class=\"paragraph\"\u003E\"Maintains backward compatibility\" seems to go as far as using \u003Ccode\u003Eaws:SourceOwner\u003C/code\u003E in the default policy.\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003E[2] \u003Ca href=\"https://github.com/awsdocs/iam-user-guide/issues/111\" rel=\"noopener\" target=\"_blank\"\u003Ehttps://github.com/awsdocs/iam-user-guide/issues/111\u003C/a\u003E\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EAWS say they're not going to document \u003Ccode\u003ESourceOwner\u003C/code\u003E because deprecated.\nOk, but then, as one of the comments says, why keep using it in the default policy?\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003E[3] \u003Ca href=\"https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_sns/Topic.html#aws_cdk.aws_sns.Topic.add_to_resource_policy\" rel=\"noopener\" target=\"_blank\"\u003Ehttps://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_sns/Topic.html#aws_cdk.aws_sns.Topic.add_to_resource_policy\u003C/a\u003E\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}], "metadata": {"marimo_version": "0.18.1"}, "version": "1"},
            "runtimeConfig": null,
        };
    </script>
  
<marimo-code hidden="">
    import%20marimo%0A%0A__generated_with%20%3D%20%220.18.1%22%0Aapp%20%3D%20marimo.App(width%3D%22medium%22)%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_()%3A%0A%20%20%20%20import%20marimo%20as%20mo%0A%20%20%20%20return%20(mo%2C)%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%20SNS%20Publish%20Permissions%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20When%20Bad%20Thing%20happens%2C%20aws%20puts%20an%20event%20onto%20our%20event%20bus.%0A%20%20%20%20We%20have%20an%20eventbridge%20rule%20to%20publish%20the%20event%20to%20an%20sns%20topic%20so%20that%20we%20get%20emailed.%0A%20%20%20%20But%20no%20email%20arrived.%0A%20%20%20%20How%20come%3F%0A%0A%20%20%20%20The%20rule's%20metrics%20show%20a%20failed%20invocation.%0A%20%20%20%20So%20the%20event%20was%20emitted%20and%20matched%20the%20rule%2C%0A%20%20%20%20but%20the%20rule%20failed%20to%20publish%20to%20the%20topic.%0A%0A%20%20%20%20We%20have%20a%20cloudwatch%20alarm%20which%20publishes%20to%20that%20topic%20too.%0A%20%20%20%20We%20_do_%20get%20emails%20when%20the%20alarm%20goes%20off.%0A%20%20%20%20So%20the%20alarm%20is%20working%20as%20expected%20but%20not%20the%20rule.%0A%0A%20%20%20%20We%20set%20up%20the%20alarm%20and%20the%20rule%20via%20cdk.%0A%20%20%20%20We%20import%20the%20topic%2C%20created%20elsewhere%2C%20into%20the%20stack%20via%20the%20%60from_topic_arn%60%20method.%0A%20%20%20%20We%20configure%20the%20rule%20to%20publish%20to%20the%20topic%20via%20the%20%60Rule%60%20construct's%20%60add_target%60%20method.%0A%20%20%20%20We%20configure%20the%20alarm%20to%20publish%20to%20the%20topic%20via%20the%20%60Alarm%60%20construct's%20%60add_alarm_action%60%20method.%0A%20%20%20%20Similar%2C%20yet%20the%20alarm%20works%20and%20the%20rule%20doesn't.%0A%0A%20%20%20%20Maybe%20a%20permissions%20issue%3F%0A%20%20%20%20Does%20it%20matter%20that%20the%20topic%20was%20imported%2C%20not%20created%3F%0A%20%20%20%20What%20are%20the%20default%20permissions%3F%0A%20%20%20%20How%20do%20the%20cdk%20methods%20modify%20them%3F%0A%0A%20%20%20%20I'll%20investigate%20using%20a%20simple%20stack.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%23%20Stack%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.mermaid(%0A%20%20%20%20%20%20%20%20%22%22%22%0A%20%20%20%20graph%20LR%0A%20%20%20%20%20%20%20%20Z1%3A%3A%3Ahidden%20--%3E%7Cinvoking%7C%20A%5Bnoop%20%CE%BB%5D%0A%20%20%20%20%20%20%20%20A%20--%3E%7Ctriggers%7C%20B%5Balarm%5D%0A%20%20%20%20%20%20%20%20B%20--%3E%7Cpublishes%20to%7C%20C%5Bpre-existing%20topic%5D%0A%20%20%20%20%20%20%20%20C%20--%3E%7Cinvokes%7C%20D%5Btarget%20%CE%BB%5D%0A%0A%20%20%20%20%20%20%20%20Z2%3A%3A%3Ahidden%20--%3E%7Cputting%7C%20E%5Bevent%5D%20%0A%20%20%20%20%20%20%20%20E%20--%3E%7Cmatches%7C%20F%5Brule%5D%0A%20%20%20%20%20%20%20%20F%20--%3E%7Cpublishes%20to%7C%20G%5Btopic%5D%0A%20%20%20%20%20%20%20%20G%20--%3E%7Cinvokes%7C%20H%5Btarget%20%CE%BB%5D%0A%0A%20%20%20%20%20%20%20%20B%20--%3E%7Cpublishes%20to%7C%20G%0A%20%20%20%20%20%20%20%20F%20--%3E%7Cpublishes%20to%7C%20C%0A%0A%20%20%20%20%22%22%22%0A%20%20%20%20)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%23%20Investigation%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20from%20datetime%20import%20datetime%2C%20timezone%0A%0A%20%20%20%20import%20boto3%0A%0A%20%20%20%20lambda_%20%3D%20boto3.client(%22lambda%22)%0A%20%20%20%20events%20%3D%20boto3.client(%22events%22)%0A%20%20%20%20return%20boto3%2C%20datetime%2C%20events%2C%20lambda_%2C%20timezone%0A%0A%0A%40app.cell%0Adef%20_(datetime%2C%20events%2C%20lambda_%2C%20timezone)%3A%0A%20%20%20%20start_time%20%3D%20datetime.now(timezone.utc)%0A%20%20%20%20invoke_response%20%3D%20lambda_.invoke(FunctionName%3D%22noop%22)%0A%20%20%20%20put_events_response%20%3D%20events.put_events(%0A%20%20%20%20%20%20%20%20Entries%3D%5B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22Source%22%3A%20%22my_source%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22DetailType%22%3A%20%22my_detail_type%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22Detail%22%3A%20%22%7B%7D%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%5D%0A%20%20%20%20)%0A%20%20%20%20return%20invoke_response%2C%20put_events_response%2C%20start_time%0A%0A%0A%40app.cell%0Adef%20_(start_time)%3A%0A%20%20%20%20start_time%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(invoke_response)%3A%0A%20%20%20%20assert%20invoke_response%5B%22StatusCode%22%5D%20%3D%3D%20200%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(put_events_response)%3A%0A%20%20%20%20assert%20put_events_response%5B%22FailedEntryCount%22%5D%20%3D%3D%200%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20Which%20topics%20did%20the%20alarm%20and%20rule%20successfully%20publish%20to%3F%0A%20%20%20%20We'll%20wait%20a%20bit%20then%20check%20the%20target%20lambdas.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20import%20time%0A%0A%20%20%20%20time.sleep(4%20*%2060)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(boto3)%3A%0A%20%20%20%20cloudwatch%20%3D%20boto3.client(%22cloudwatch%22)%0A%20%20%20%20return%20(cloudwatch%2C)%0A%0A%0A%40app.cell%0Adef%20_(cloudwatch%2C%20datetime%2C%20start_time%2C%20timezone)%3A%0A%20%20%20%20cloudwatch.get_metric_statistics(%0A%20%20%20%20%20%20%20%20MetricName%3D%22Invocations%22%2C%0A%20%20%20%20%20%20%20%20Namespace%3D%22AWS%2FLambda%22%2C%0A%20%20%20%20%20%20%20%20Dimensions%3D%5B%7B%22Name%22%3A%20%22FunctionName%22%2C%20%22Value%22%3A%20%22pre_existing_topic_target%22%7D%5D%2C%0A%20%20%20%20%20%20%20%20StartTime%3Dstart_time%2C%0A%20%20%20%20%20%20%20%20EndTime%3Ddatetime.now(timezone.utc)%2C%0A%20%20%20%20%20%20%20%20Statistics%3D%5B%22Sum%22%5D%2C%0A%20%20%20%20%20%20%20%20Period%3D60%2C%0A%20%20%20%20)%5B%22Datapoints%22%5D%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(cloudwatch%2C%20datetime%2C%20start_time%2C%20timezone)%3A%0A%20%20%20%20cloudwatch.get_metric_statistics(%0A%20%20%20%20%20%20%20%20MetricName%3D%22Invocations%22%2C%0A%20%20%20%20%20%20%20%20Namespace%3D%22AWS%2FLambda%22%2C%0A%20%20%20%20%20%20%20%20Dimensions%3D%5B%7B%22Name%22%3A%20%22FunctionName%22%2C%20%22Value%22%3A%20%22topic_target%22%7D%5D%2C%0A%20%20%20%20%20%20%20%20StartTime%3Dstart_time%2C%0A%20%20%20%20%20%20%20%20EndTime%3Ddatetime.now(timezone.utc)%2C%0A%20%20%20%20%20%20%20%20Statistics%3D%5B%22Sum%22%5D%2C%0A%20%20%20%20%20%20%20%20Period%3D60%2C%0A%20%20%20%20)%5B%22Datapoints%22%5D%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20For%20the%20pre-existing%20topic%20and%20for%20the%20new%20topic%2C%20one%20publish%20succeeded%20and%20the%20other%20failed.%20Which%3F%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(cloudwatch%2C%20datetime%2C%20start_time%2C%20timezone)%3A%0A%20%20%20%20cloudwatch.describe_alarm_history(%0A%20%20%20%20%20%20%20%20StartDate%3Dstart_time%2C%0A%20%20%20%20%20%20%20%20EndDate%3Ddatetime.now(timezone.utc)%2C%0A%20%20%20%20%20%20%20%20AlarmName%3D%22noop_lambda_invocation_alarm%22%2C%0A%20%20%20%20)%5B%22AlarmHistoryItems%22%5D%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20Cloudwatch%20published%20ok%20to%20the%20pre-existing%20topic%20but%20failed%20to%20publish%20to%20the%20new%20topic%20because%0A%0A%20%20%20%20%3E%20CloudWatch%20Alarms%20is%20not%20authorized%20to%20perform%3A%20SNS%3APublish%20on%20resource%3Aarn%3Aaws%3Asns%3Aeu-west-2%3A872115063659%3Amy_topic%0A%0A%20%20%20%20That%20means%20eventbridge%20published%20ok%20to%20the%20new%20topic%20but%20not%20to%20the%20pre-existing%20topic.%0A%0A%20%20%20%20What%20are%20the%20topic%20permissions%3F%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(boto3)%3A%0A%20%20%20%20import%20json%0A%20%20%20%20from%20os%20import%20environ%0A%0A%20%20%20%20sns%20%3D%20boto3.client(%22sns%22)%0A%20%20%20%20return%20environ%2C%20json%2C%20sns%0A%0A%0A%40app.cell%0Adef%20_(environ%2C%20json%2C%20sns)%3A%0A%20%20%20%20_%20%3D%20sns.get_topic_attributes(TopicArn%3Df%22arn%3Aaws%3Asns%3A%7Benviron%5B'REGION'%5D%7D%3A%7Benviron%5B'ACCOUNT_ID'%5D%7D%3Apre_existing_topic%22)%0A%20%20%20%20json.loads(_%5B%22Attributes%22%5D%5B%22Policy%22%5D)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20Based%20on%20the%20%60Id%60%2C%20this%20must%20be%20a%20topic's%20default%20access%20policy.%0A%0A%20%20%20%20And%20it%20must%20be%20that%20cloudwatch%20satisfies%20the%20%60AWS%3ASourceOwner%60%20condition%20and%20eventbridge%20doesn't.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(environ%2C%20json%2C%20sns)%3A%0A%20%20%20%20_%20%3D%20sns.get_topic_attributes(TopicArn%3Df%22arn%3Aaws%3Asns%3A%7Benviron%5B'REGION'%5D%7D%3A%7Benviron%5B'ACCOUNT_ID'%5D%7D%3Amy_topic%22)%0A%20%20%20%20json.loads(_%5B%22Attributes%22%5D%5B%22Policy%22%5D)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20Ok%2C%20that's%20clear%3A%20eventbridge%20has%20permission%20to%20publish%20to%20the%20new%20topic%20and%20cloudwatch%20does%20not.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20How%20come%20these%20permissions%3F%0A%20%20%20%20Here's%20what%20I%20think%20has%20happened.%0A%0A%20%20%20%20I%20created%20the%20new%20topic%20in%20the%20stack%2C%0A%20%20%20%20and%20added%20subscriptions%20via%20%60add_target%60%20and%20%60add_alarm_action%60.%0A%20%20%20%20%60add_target%60%20modifies%20the%20access%20policy%2C%20permitting%20eventbridge.%0A%20%20%20%20But%20%60add_alarm_action%60%20does%20not%3A%0A%20%20%20%20you%20have%20to%20give%20cloudwatch%20permission%20yourself.%0A%20%20%20%20That's%20the%20**first%20surprise**.%0A%0A%20%20%20%20The%20**second%20surprise**%20is%20that%20%60add_target%60%20doesn't%20add%20permissions%0A%20%20%20%20on%20top%20of%20the%20default%20%60AWS%3ASourceOwner%60%20policy.%0A%20%20%20%20Instead%2C%20it%20replaces%20the%20default%20policy.%0A%20%20%20%20The%20docs%20make%20this%20clear%20for%20%60add_to_resource_policy%60%3A%0A%0A%20%20%20%20%3E%20If%20this%20topic%20was%20created%20in%20this%20stack%20(%60new%20Topic%60)%2C%20a%20topic%20policy%20will%20be%20automatically%20created%20upon%20the%20first%20call%20to%20%60addToResourcePolicy%60.%0A%0A%20%20%20%20and%20I%20suppose%20it's%20implicit%20that%20the%20same%20applies%20to%20other%20permissions-changing%20methods%2C%0A%20%20%20%20such%20as%20%60add_target%60.%0A%0A%20%20%20%20I%20created%20the%20pre-existing%20topic%20in%20another%20stack%2C%20with%20all%20defaults.%0A%20%20%20%20It%20has%20the%20default%20policy%20based%20on%20%60AWS%3ASourceOwner%60.%0A%20%20%20%20I%20imported%20the%20topic%20into%20the%20stack%20via%20%60from_topic_arn%60%2C%0A%20%20%20%20then%20added%20subscriptions%20via%20%60add_target%60%20and%20%60add_alarm_action%60.%0A%20%20%20%20Because%20the%20topic%20was%20imported%2C%0A%20%20%20%20neither%20method%20changed%20the%20access%20policy.%0A%20%20%20%20But%20%E2%80%94%20**third%20surprise**%20%E2%80%94%20cloudwatch%20passes%20the%20policy%20and%20events%20doesn't.%0A%0A%20%20%20%20A%20**fourth%20surprise**.%0A%20%20%20%20It%20makes%20sense%20that%20the%20cdk%20methods%20didn't%20change%20the%20pre-existing%20topic's%20policy.%0A%20%20%20%20It%20would%20be%20confusing%20if%20stacks%20could%20modify%20resources%20they%20didn't%20create.%0A%20%20%20%20Except%20sometimes%20they%20do!%0A%20%20%20%20For%20example%2C%20in%20our%20stack%20we%20_were_%20able%20to%20add%20the%20target%20lambda%20subscription%20to%20the%20pre-existing%20topic.%0A%20%20%20%20So%20cdk%20_doesn't_%20strictly%20observe%20the%20%22stacks%20can't%20modify%20resources%20they%20didn't%20create%22%20rule.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%23%20References%0A%0A%20%20%20%20%5B1%5D%20https%3A%2F%2Fdocs.aws.amazon.com%2Fsns%2Flatest%2Fdg%2Fsns-access-policy-use-cases.html%23sns-allow-specified-service-to-publish-to-topic%0A%0A%20%20%20%20Confirms%20that%20cloudwatch%20supports%20%60AWS%3ASourceOwner%60%20and%20eventbridge%20does%20not.%0A%0A%20%20%20%20Warns%20that%0A%0A%20%20%20%20%3E%20%60aws%3ASourceOwner%60%20is%20deprecated%20and%20new%20services%20can%20integrate%20with%20Amazon%20SNS%0A%20%20%20%20%3E%20only%20through%20%60aws%3ASourceArn%60%20and%20%60aws%3ASourceAccount%60.%0A%20%20%20%20%3E%20Amazon%20SNS%20still%20maintains%20backward%20compatibility%20for%20existing%20services%0A%20%20%20%20%3E%20that%20are%20currently%20supporting%20%60aws%3ASourceOwner%60.%0A%0A%20%20%20%20%22Maintains%20backward%20compatibility%22%20seems%20to%20go%20as%20far%20as%20using%20%60aws%3ASourceOwner%60%20in%20the%20default%20policy.%0A%0A%20%20%20%20%5B2%5D%20https%3A%2F%2Fgithub.com%2Fawsdocs%2Fiam-user-guide%2Fissues%2F111%0A%0A%20%20%20%20AWS%20say%20they're%20not%20going%20to%20document%20%60SourceOwner%60%20because%20deprecated.%0A%20%20%20%20Ok%2C%20but%20then%2C%20as%20one%20of%20the%20comments%20says%2C%20why%20keep%20using%20it%20in%20the%20default%20policy%3F%0A%0A%20%20%20%20%5B3%5D%20https%3A%2F%2Fdocs.aws.amazon.com%2Fcdk%2Fapi%2Fv2%2Fpython%2Faws_cdk.aws_sns%2FTopic.html%23aws_cdk.aws_sns.Topic.add_to_resource_policy%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0Aif%20__name__%20%3D%3D%20%22__main__%22%3A%0A%20%20%20%20app.run()%0A
</marimo-code>

<marimo-code-hash hidden="">daee21e23e3cca925165a6673e97534e</marimo-code-hash>
</body>
</html>
