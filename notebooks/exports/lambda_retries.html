<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/favicon.ico" />
    <!-- Preload is necessary because we show these images when we disconnect from the server,
    but at that point we cannot load these images from the server -->
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/gradient-yHQUC_QB.png" as="image" />
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/noise-60BoTA8O.png" as="image" />
    <!-- Preload the fonts -->
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/Lora-VariableFont_wght-B2ootaw-.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/PTSans-Regular-CxL0S8W7.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/PTSans-Bold-D9fedIX3.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/FiraMono-Regular-BTCkDNvf.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/FiraMono-Medium-DU3aDxX5.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/FiraMono-Bold-CLVRCuM9.ttf" as="font" crossorigin="anonymous" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta name="description" content="a marimo app" />
    <link rel="apple-touch-icon" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/apple-touch-icon.png" />
    <link rel="manifest" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/manifest.json" />

    <script data-marimo="true">
      function __resizeIframe(obj) {
        var scrollbarHeight = 20; // Max between windows, mac, and linux

        function setHeight() {
          // Guard against race condition where iframe isn't ready
          if (!obj.contentWindow?.document?.documentElement) {
            return;
          }
          var element = obj.contentWindow.document.documentElement;
          // If there is no vertical scrollbar, we don't need to resize the iframe
          if (element.scrollHeight === element.clientHeight) {
            return;
          }

          // Create a new height that includes the scrollbar height if it's visible
          var hasHorizontalScrollbar = element.scrollWidth > element.clientWidth;
          var newHeight = element.scrollHeight + (hasHorizontalScrollbar ? scrollbarHeight : 0);

          // Only update the height if it's different from the current height
          if (obj.style.height !== `${newHeight}px`) {
            obj.style.height = `${newHeight}px`;
          }
        }

        // Resize the iframe to the height of the content and bottom scrollbar height
        setHeight();

        // Resize the iframe when the content changes
        const resizeObserver = new ResizeObserver((entries) => {
          setHeight();
        });
        // Only observe if iframe content is ready
        if (obj.contentWindow?.document?.body) {
          resizeObserver.observe(obj.contentWindow.document.body);
        }
      }
    </script>
    <marimo-filename hidden>lambda_retries.py</marimo-filename>
    <!-- TODO(Trevor): Legacy, required by VS Code plugin. Remove when plugin is updated (see marimo/server/_templates/template.py) -->
    <marimo-version data-version="{{ version }}" hidden></marimo-version>
    <marimo-user-config data-config="{{ user_config }}" hidden></marimo-user-config>
    <marimo-server-token data-token="{{ server_token }}" hidden></marimo-server-token>
    <!-- /TODO -->
    <title>lambda retries</title>
    <script type="module" crossorigin crossorigin="anonymous" src="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/index-BXqkmYCF.js"></script>
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/preload-helper-BnutJmlU.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/chunk-DZLz74EQ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/react-BcIddLXZ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/compiler-runtime-Cr9loedd.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/jsx-runtime-mwDPpfh_.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/useEventListener-D1FLsfmf.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/react-dom-D6bRRS5R.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/Combination-BjaZc6gK.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/clsx-BlAkgCmw.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/cn-ZXtYmczU.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/menu-items-DwOFR2Zi.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/hotkeys-ClCtr3_I.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/button-ZC2axIBq.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/dist-o-4-WxUj.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/createLucideIcon-CNVopWor.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/check-CuBLr6Cm.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/select-5fcaZwou.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/multi-map-D9JaQ_m6.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/chevron-right-BV0VfNbL.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/dropdown-menu-uN_XMhZm.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/tooltip-BHnVWzH0.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/_Uint8Array-D5Z9rM2X.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/_getTag-CVRrQL_Q.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/_baseIsEqual-CVFfFJm2.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/jotai-BTnrNcC1.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/invariant-D5a0EE05.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/isArrayLikeObject-DKyJYtr8.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/merge-Dvc5opZF.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/zod-U2NFpcFA.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/utils-DEDX0RLo.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/requests-BACZP_uj.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/once-C5bmD4W5.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/toDate-C3oOx2yr.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/_baseSlice-BWZ0PeaJ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/_arrayMap-DQI2GUNb.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/isSymbol-xTSywenE.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/toString-CBnct2wx.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/_hasUnicode-3DIK_jNi.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/upperFirst-CBQfDRod.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/capitalize-CBqvgOfA.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/ai-model-dropdown-CvhbTHha.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/badge-Jfhpc30N.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/use-toast-midBZAtS.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/constants-CEISdYm1.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/Deferred-NfAvvkGM.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/config-C6qInAhC.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/uuid-D0hUC3Qw.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/key-Cx1qY8eM.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/connection-Bs4SQ_vu.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/useLifecycle-DogGOXPh.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/useNonce-VIoWEX5z.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/capabilities-srilPYuF.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/createReducer-CeLhipaI.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/dist-MHIqsPCF.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/dist-8_YHxBVW.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/dist-CbvGwhr0.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/dist-CPUmJw_F.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/dist-DcDuMWp5.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/dist-DJV2CjUA.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/dist-C14Sk-Bd.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/dist-vBG1bGij.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/dist-Oad1venD.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/stex-xveX5l_T.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/cjs-Ck8KMDI1.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/_baseProperty-c4IQJQis.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/toNumber-CTOPJrpu.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/now-BXqTLlmI.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/debounce-BUM2losY.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/toInteger-Bor4StOs.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/type-o43RKOcp.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/marked.esm-BV7g2d65.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/main-ChjX94eX.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/cells-A69p56PE.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/kbd-DbVT085u.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/renderShortcut-DJmsjON-.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/useEvent-CRDKqG3C.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/useDeleteCell-CEsjHDdl.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/lazy-oPCv0nK8.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/defaultLocale-YmL2k7Vp.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/precisionRound-Qxa8hC2h.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/defaultLocale-zQltfbSS.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/vega-loader.browser-D2m26-DP.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/tooltip-BFMRXuzR.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/ErrorBoundary-_uEOjNWh.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/alert-dialog-8EwWlboa.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/dialog-BfhgTWm1.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/useDebounce-DzG_89QJ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/numbers-CTSqyVyD.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/SSRProvider-B8x7qo1c.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/context-CcLKJeA2.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/useNumberFormatter-F8R3LBxf.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/usePress-BO20vkQb.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/input-BNb8K99m.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/ImperativeModal-C4fZHLKz.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/cell-link-D75IV6D1.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/alert-BqjCH_7t.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/links-CMl0qG9J.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/state-JZFfOGr9.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/MarimoErrorOutput-BATnwNYX.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/spinner-CuquyDWA.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/_arrayReduce-DV4IVFuG.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/startCase-RfubwhHM.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/strings-DHsDEFo-.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/command-Dlk4i3l7.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/popover-F0Sfc1dn.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/useRunCells-BLpH_l8E.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/copy-LsxoSTiV.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/copy-Dy_tLkL8.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/copy-icon-CE7wmMnS.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/mode-Bq6LjPC-.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/purify.es-CPMOFAIu.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/RenderHTML-DTLkV9Uh.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/table-DU76OrPF.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/tabs-l9npw3ob.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/useAsyncData-CngUoIwV.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/useIframeCapabilities-DXQ78nsN.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/error-banner-DoSAS3iD.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/formats-BN93kMCb.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/useTheme-Biy2QI0v.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/en-US-D2gH55FJ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/isValid-BJSfXqfd.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/maps-B1z3jt-a.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/shim-Cc3VMan6.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/download-ByFIcaoi.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/extends-dwNt6GDg.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/emotion-is-prop-valid.esm-OoyWz_0l.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/useDateFormatter-CPDTrKqK.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/range-ZclXTdAh.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/table-C2gUjtJV.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/Output-DWmT-7NV.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/name-cell-input-DND1MD7b.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/useHotkey-NDxGNWnW.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/objectWithoutPropertiesLoose-COpOcp6W.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/esm-B3nKz9z-.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/dist-GE2AwHvG.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/dist-CMHCymvx.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/dist-ta4iJSan.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/dist-BcppZLnk.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/dist-DRTi9ht4.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/dist-BjGT2Oog.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/dist-CXL8T4lt.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/dist-B0B_Xnwd.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/dist-BcgNLefj.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/dist-j2I9I0a7.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/dist-DM2w8f7r.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/dist-nhBdVy6b.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/dist-D-JTXier.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/apl-BGS-6pM9.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/asciiarmor-CbQH35y7.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/asn1-P7HrFGaM.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/brainfuck-CSxeyQc4.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/clike-Bg9duJDo.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/clojure-B94DOmFw.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/cmake-DQEKyMNG.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/cobol-CY4gVoPW.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/coffeescript-BwWb96Ts.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/commonlisp-Cq_n1sF6.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/crystal-BLTq7Sqq.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/css-CmDcdojQ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/cypher-ByytCYVx.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/d-xLFRg71F.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/diff-VF6GbDch.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/dtd-D8qb8bJW.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/dylan-CIkom9X4.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/ecl-8wcmTiom.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/eiffel-D2ZBcT03.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/elm-Cpg3TnMc.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/erlang-B4A2pXCG.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/simple-mode-BrL6eoj-.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/factor-DhbRkYZ5.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/forth-C5F1F4pC.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/fortran-D7Gl3Tli.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/gas-BS2f8qHc.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/gherkin-CVZcskwU.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/groovy-BhQsBMwW.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/haskell-BPbxlKgK.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/haxe-TKSAmiMf.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/idl-DFgQu5Ek.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/javascript-dAA8UGkz.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/jinja2-BIbcpWyF.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/julia-CfdFJG3K.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/livescript-FcXY3DYa.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/lua-Co6rjiMf.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/mathematica-yb42KhnJ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/mbox-Kdy3h0JS.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/mirc-DIfBuSAc.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/mllike-ClozcVVR.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/modelica-DfSVZeoi.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/mscgen-BCcB4vmY.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/mumps-Zs7zFruB.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/nsis-znELVT3h.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/ntriples-BZ-Gx5MV.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/octave-DbhnFGQl.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/oz-C8cfEyhB.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/pascal-DjQLfZxE.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/perl-BbHwsgL1.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/pig-siFNrhhJ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/powershell-DtGrdgtc.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/properties-ThqBcpfC.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/protobuf-RiYv9VfD.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/pug-DUVdXXqU.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/puppet-U5CQLRYv.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/python-Bwt6zAaD.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/q-DIhdXtBp.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/r-CWawXx6U.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/rpm-CNr8ALvx.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/ruby-DskfS84U.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/sas-C2b2tSOH.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/scheme-Cmmcrp64.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/shell-Dyv1aCg9.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/sieve-B_dGzCIS.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/smalltalk-intFzbz6.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/sparql-BX1c9HJU.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/stylus-X6xt1FMB.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/swift-BYNJXGdg.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/tcl-BaybuQuE.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/textile-77KFAyfi.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/toml-D6E8t1IG.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/troff-BfktZMhT.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/ttcn-cfg-CstA0KVC.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/ttcn-DOlRqUFL.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/turtle-Cx-tHjh2.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/vb-DerFRxqu.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/vbscript-BPEY3B7J.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/velocity-B-lFP8Gk.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/verilog-C9TzcLDl.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/vhdl-v8a_uH2H.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/webidl-DmZw40AA.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/xquery-BrIWpdRx.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/yacas-ofPECLUx.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/z80-DrGVKC-O.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/esm-DtCFmQ1n.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/trash-CRcefzxk.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/ConsoleOutput-BJP_UIwR.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/icons-DaFojEUL.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/add-missing-import-Bc1Nj8aC.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/blob-ISoY06EG.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/add-cell-with-ai-Bf3hYYIu.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/chart-no-axes-column-DYZiSI6e.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/square-function-sjebOKTF.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/spec-C5SzKl5N.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/focus-BaSDCTOl.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/useInstallPackage-I3kefbOO.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/column-preview-WPlkULp9.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/useAddCell-CREgcbTt.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/toggle-DlfY8wql.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/api-YJHlT7KM.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/globals-Dp5TPAWC.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/share-8z32Sr0F.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/dist-DBrqGLzW.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/memoize-DhF8x4Aa.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/_toKey-16owuO_q.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/_baseSet-L2qemYhz.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/utilities.esm-Bjl8-mRM.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/floating-outline-1_-JOoBX.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/eye-off-_Bp7Ir5E.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/plus-CRGccegF.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/readonly-python-code-B4MS39iL.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/file-video-camera-DJUITpag.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/file-text-CFgIi1A4.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/file-Cz8xVTWu.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/types-Bh2kSb2q.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/label-Dcu3RhQ4.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/form-CaSJmn0I.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/textarea-DeG5mMSH.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/circle-x-Dm9uA-wT.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/refresh-ccw-Dg4gNnPm.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/trash-2-BPux4_UF.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/form-DaO98mWt.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/field-CaHPDBhq.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/switch-4s4187gV.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/useBoolean-CpaqzlKu.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/useDeepCompareMemoize-DiJVYA6I.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/LazyAnyLanguageCodeMirror-BovGLUi6.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/types-CHAkS4Oz.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/prop-types-Dr_68tMt.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/es-vLBD1nBl.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/VisuallyHidden-DqOWapbP.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/_baseFlatten-ViL-mfkw.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/get-BUGWIXZE.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/hasIn-BgJKauE7.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/_basePickBy-CSDa7ReR.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/pick-BQzWKfma.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/square-CYRwTwZO.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/download-ptuQ0M1w.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/globe-mi3m-i9B.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/send-CTRovYct.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/refresh-cw-Duwwh0cP.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/settings-p8vTgdrN.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/bundle.esm-BEDtDq85.js">
    <link rel="stylesheet" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/cells-BvrC6Bsv.css">
    <link rel="stylesheet" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/Output-j3zW187k.css">
    <link rel="stylesheet" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/ConsoleOutput-BFFTcC5Y.css">
    <link rel="stylesheet" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/index-BmcO-QYJ.css">
  
<script data-marimo="true">
    window.__MARIMO_STATIC__ = {};
    window.__MARIMO_STATIC__.files = {};
</script>
</head>
  <body>
    <div id="root"></div>
    <!-- This is a portal for the data editor to render in -->
    <div id="portal" data-testid="glide-portal" style="position: fixed; left: 0; top: 0; z-index: 9999"></div>
    <script data-marimo="true">
      window.__MARIMO_MOUNT_CONFIG__ = {
            "filename": "lambda_retries.py",
            "mode": "read",
            "version": "0.17.7",
            "serverToken": "static",
            "config": {"ai": {"models": {"custom_models": [], "displayed_models": []}}, "completion": {"activate_on_typing": true, "copilot": false}, "diagnostics": {"sql_linter": true}, "display": {"cell_output": "below", "code_editor_font_size": 14, "dataframes": "rich", "default_table_max_columns": 50, "default_table_page_size": 10, "default_width": "medium", "reference_highlighting": false, "theme": "light"}, "formatting": {"line_length": 79}, "keymap": {"overrides": {}, "preset": "default"}, "language_servers": {"pylsp": {"enable_flake8": false, "enable_mypy": true, "enable_pydocstyle": false, "enable_pyflakes": false, "enable_pylint": false, "enable_ruff": true, "enabled": false}}, "mcp": {"mcpServers": {}, "presets": []}, "package_management": {"manager": "pip"}, "runtime": {"auto_instantiate": false, "auto_reload": "off", "default_sql_output": "auto", "on_cell_change": "autorun", "output_max_bytes": 8000000, "reactive_tests": true, "std_stream_max_bytes": 1000000, "watcher_on_save": "lazy"}, "save": {"autosave": "after_delay", "autosave_delay": 1000, "format_on_save": false}, "server": {"browser": "default", "follow_symlink": false}, "snippets": {"custom_paths": [], "include_default_snippets": true}},
            "configOverrides": {},
            "appConfig": {"sql_output": "auto", "width": "medium"},
            "view": {"showAppCode": true},
            "notebook": {"cells": [{"code": "import marimo as mo", "code_hash": "1d0db38904205bec4d6f6f6a1f6cec3e", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "Hbol", "name": "_"}, {"code": "mo.md(r\"\"\"\n# Lambda Retries\n\nWhen a function invocation fails, does the Lambda service retry ?\nHow often, and with what backoff?\nDoes it depend on the invocation type (synchronous or asynchronous) or the failure reason (timeout, exception, throttling)?\n\"\"\")", "code_hash": "833c385ddd0feb68c6f048aa0ab8c86c", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "MJUe", "name": "_"}, {"code": "mo.md(r\"\"\"\n## Stack\n\nA bunch of functions:\n\n- `async_handler_raises_exception`\n- `sync_handler_raises_exception`\n- `async_invocation_times_out`\n- `sync_invocation_times_out`\n- `async_throttled`\n- `sync_throttled`\n\neach doing what its name suggests,\nand a log group for each.\n\nThe `async*` and `sync*` prefixes just indicate how I'll call the functions,\nnothing about the functions themselves.\n\nI have `async` and `sync` versions\nso I can call them concurrently without getting confused.\n\nBy default functions sends logs to an automatically created log group.\nBut that log group is not configurable\n(e.g. you should not set its removal policy).\nSo the docs recommend creating your own and passing it in,\nwhich is what I've done.\n\"\"\")", "code_hash": "c09d557a5bfa051f0de06153ff460991", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "vblA", "name": "_"}, {"code": "mo.md(r\"\"\"\n## Investigation\n\"\"\")", "code_hash": "9a772d95030c40122a70312309d3c705", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "bkHC", "name": "_"}, {"code": "mo.md(r\"\"\"\n### Set up boto3 clients\n\nWe'll use boto3 to invoke and monitor the functions.\n\nBut by default boto3 automatically retries for certain errors, such as `ThrottlingException` [1].\nWe don't want boto3 to retry: it would be confusing.\n(Was this function invoked twice because boto3 retried or because Lambda retried?)\nSo let's disable.\n\"\"\")", "code_hash": "278169008a7cd6af43503364964f52a8", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "lEQa", "name": "_"}, {"code": "import boto3\nimport botocore", "code_hash": "b49c1d77ee2d2cd2d1276de57fea5136", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "PKri", "name": "_"}, {"code": "config = botocore.config.Config(retries={\"total_max_attempts\": 1})\nlogs = boto3.client(\"logs\", config=config)\nlambda_ = boto3.client(\"lambda\", config=config)\ncloudwatch = boto3.client(\"cloudwatch\", config=config)", "code_hash": "a93b64827a32dbe794a3da1f5476aa9a", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "Xref", "name": "_"}, {"code": "mo.md(r\"\"\"\nThe `retries` dictionary accepts\na `total_max_attempts` key, which _includes_ the initial attempt,\nor a `max_attempts` key, which _excludes_ it.\nConfusing!\n\nUsing \"retries\" is always confusing.\nDoes \"third retry\" mean third try or fourth try?\nThrow 0 vs 1-indexing into the mix\n(say you store an array with an item for each try)\nand you're asking for trouble.\n\"\"\")", "code_hash": "7e5c1c987976ad5d5f8a844f84b66aa4", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "SFPL", "name": "_"}, {"code": "mo.md(r\"\"\"\n### Throttle\n\nTwo of the lambdas 've deployed are for checking retries given throttling.\nSo throttle them.\n\"\"\")", "code_hash": "904461ab0b5961c773dd7ba611e0aac5", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "BYtC", "name": "_"}, {"code": "lambda_.put_function_concurrency(\n    FunctionName=\"async_throttled\",\n    ReservedConcurrentExecutions=0,\n)", "code_hash": "5b7cc4a65933e5210b4da79bc9e8f75c", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "RGSE", "name": "_"}, {"code": "lambda_.put_function_concurrency(\n    FunctionName=\"sync_throttled\",\n    ReservedConcurrentExecutions=0,\n)", "code_hash": "57fe7667516667b80c87d109049771a1", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "Kclp", "name": "_"}, {"code": "mo.md(r\"\"\"\n### Invoke the functions\n\"\"\")", "code_hash": "8d341f50378e5cd5c0925d947c80cee1", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "emfo", "name": "_"}, {"code": "import datetime\nfrom pprint import pprint", "code_hash": "96a576a7669d4a5d73624d3430eb489c", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "Hstk", "name": "_"}, {"code": "call_times = {}", "code_hash": "e58d85f70addb972a27aad7d9c1e0c97", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "nWHF", "name": "_"}, {"code": "call_times[\"async_handler_raises_exception\"] = datetime.datetime.now(datetime.UTC)\nlambda_.invoke(FunctionName=\"async_handler_raises_exception\", InvocationType=\"Event\")", "code_hash": "a241a2b54fd868442adb63ab429c496b", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "iLit", "name": "_"}, {"code": "call_times[\"async_invocation_times_out\"] = datetime.datetime.now(datetime.UTC)\nlambda_.invoke(FunctionName=\"async_invocation_times_out\", InvocationType=\"Event\")", "code_hash": "431109c07c4c953d547ce7cedb90f94e", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "ZHCJ", "name": "_"}, {"code": "call_times[\"async_throttled\"] = datetime.datetime.now(datetime.UTC)\n# async invocation so we don't get TooManyRequestsException\nlambda_.invoke(FunctionName=\"async_throttled\", InvocationType=\"Event\")", "code_hash": "bcb7929b21bc39e140d5d6d229a9ebea", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "ROlb", "name": "_"}, {"code": "call_times[\"sync_handler_raises_exception\"] = datetime.datetime.now(datetime.UTC)\nlambda_.invoke(FunctionName=\"sync_handler_raises_exception\", InvocationType=\"RequestResponse\")", "code_hash": "bc2b86c67b9c38cc2d57f191cc4b5644", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "qnkX", "name": "_"}, {"code": "call_times[\"sync_invocation_times_out\"] = datetime.datetime.now(datetime.UTC)\nlambda_.invoke(FunctionName=\"sync_invocation_times_out\", InvocationType=\"RequestResponse\")", "code_hash": "11e0f5f4e978e30b76036fd0a4b9315b", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "TqIu", "name": "_"}, {"code": "call_times[\"sync_throttled\"] = datetime.datetime.now(datetime.UTC)\ntry:\n    lambda_.invoke(FunctionName=\"sync_throttled\", InvocationType=\"RequestResponse\")\nexcept botocore.exceptions.ClientError as err:\n    if err.response[\"Error\"][\"Code\"] == \"TooManyRequestsException\":\n        # sync invocation of throttled lambda, so we expect to get TooManyRequestsException\n        pprint(err.response)\n    else:\n        raise err", "code_hash": "07f10da72d8f2210a0c13d61440dd03f", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "Vxnm", "name": "_"}, {"code": "mo.md(r\"\"\"\nThe sync calls get 200 OK.\n\nExcept for `sync_throttled`,\nwhich throws a `TooManyRequestsException`\nwith underlying `'HTTPStatusCode': 429` (TooManyRequests).\n\nThe async calls get 202 Accepted:\n\n\u003E The request has been received but not yet acted upon.\n\u003E It is noncommittal, since there is no way in HTTP to later send an asynchronous response indicating the outcome of the request.\n\u003E It is intended for cases where another process or server handles the request, or for batch processing. [5]\n\"\"\")", "code_hash": "3477f7dd652cbf481d0beaad2696df44", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "DnEU", "name": "_"}, {"code": "pprint(call_times)", "code_hash": "7c9123323aba9c4b7ff367e0cfd78b92", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "ulZA", "name": "_"}, {"code": "mo.md(r\"\"\"\nLet's wait a while to give Lambda a chance to retry.\n\"\"\")", "code_hash": "192cf85b85a330661f3e1ab9ce425451", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "ecfG", "name": "_"}, {"code": "from time import sleep", "code_hash": "cd42452f1f4981ad502291ef3c9cdbfe", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "Pvdt", "name": "_"}, {"code": "sleep(5 * 60)", "code_hash": "575b07d6b89159dccc71ea27bc34ab25", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "ZBYS", "name": "_"}, {"code": "mo.md(r\"\"\"\nI'll be using the logs to find function invocations,\nsince logs have high resolution timestamps.\n\nI'll write a helper for that.\n\"\"\")", "code_hash": "e889f7e31324aa8301a4cd64a472c4ca", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "aLJB", "name": "_"}, {"code": "def get_invocations_from_logs(function_name: str) -\u003E list[float]:\n    call_timestamp_in_ms = int(call_times[function_name].timestamp()) * 1000\n\n    response = logs.filter_log_events(\n        logGroupName=f\"/aws/lambda/{function_name}\",\n        startTime=call_timestamp_in_ms,\n    )\n\n    invocations = [\n        datetime.datetime.fromtimestamp(event[\"timestamp\"] / 1000.0, tz=datetime.UTC)\n        for event in response[\"events\"]\n        if event[\"message\"].startswith(\"START\")\n    ]\n    invocations = sorted(invocations)\n\n    return invocations", "code_hash": "5d50411e8a86df929020f86fd5eb124c", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "nHfw", "name": "_"}, {"code": "mo.md(r\"\"\"\nNow let's check retries.\n\"\"\")", "code_hash": "ff2eb438c9f82520dfb4c03e0436870f", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "xXTn", "name": "_"}, {"code": "mo.md(r\"\"\"\n### asynchronous, errors\n\"\"\")", "code_hash": "790415ae57cde6082639b3c163be3140", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "AjVT", "name": "_"}, {"code": "print(\"call time:\", call_times[\"async_handler_raises_exception\"])\npprint(get_invocations_from_logs(\"async_handler_raises_exception\"))", "code_hash": "7d5e7a68c699b75a9ac792b5ca88b1d3", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "pHFh", "name": "_"}, {"code": "mo.md(r\"\"\"\nThe first invocation was a moment after the boto3 call.\nThat makes sense: the function has to init first.\nThe second invocation was about 1 minute later.\nThe third was about 2 minutes after that.\n\nThis matches the docs [4]:\n\n\u003E If the function returns an error,\n\u003E by default Lambda attempts to run it two more times, \n\u003E with a one-minute wait between the first two attempts, \n\u003E and two minutes between the second and third attempts\n\nexcept the waits are only _approximately_ one and two minutes.\n\"\"\")", "code_hash": "28d47e9bc5acd7496a45e76caff5bd23", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "NCOB", "name": "_"}, {"code": "mo.md(r\"\"\"\n### async, times out\n\"\"\")", "code_hash": "db5a76c93821434ffd3fd15788326af2", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "aqbW", "name": "_"}, {"code": "print(\"call time:\", call_times[\"async_invocation_times_out\"])\npprint(get_invocations_from_logs(\"async_invocation_times_out\"))", "code_hash": "f0aa1142e72e4da2fd9bf84120990ac0", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "TRpd", "name": "_"}, {"code": "mo.md(r\"\"\"\nSame as for error:\ntry,\nabout 1 minute wait,\ntry,\nabout 2 minute wait,\ntry.\n\nThis matches the docs too:\n\n\u003E Function errors include errors returned by the function's code and errors returned by the function's runtime, such as timeouts.\n\"\"\")", "code_hash": "2bea735e6a4948eb5fbffb639f37911d", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "TXez", "name": "_"}, {"code": "mo.md(r\"\"\"\n### async, throttled\n\"\"\")", "code_hash": "f7cf52da009c6edd168bf0ccf2202c85", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "dNNg", "name": "_"}, {"code": "print(\"call time:\", call_times[\"async_throttled\"])\npprint(get_invocations_from_logs(\"async_throttled\"))", "code_hash": "8c601dfd8b6361d40ace0357b8ce2475", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "yCnT", "name": "_"}, {"code": "mo.md(r\"\"\"\nThat makes sense: it's throttled so no invocations so no logs.\n\nCan we use the `Throttles` metric instead?\n\"\"\")", "code_hash": "c428b6a915d17c054b3bd0105588accf", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "wlCL", "name": "_"}, {"code": "def get_metric_sum(function_name: str, metric_name: str) -\u003E list[tuple]:\n    response = cloudwatch.get_metric_statistics(\n        Namespace=\"AWS/Lambda\",\n        MetricName=metric_name,\n        Dimensions=[{\"Name\": \"FunctionName\", \"Value\": function_name}],\n        StartTime=call_times[function_name],\n        EndTime=datetime.datetime.now(datetime.UTC),\n        Period=60,  # lowest possible for non-custom metrics\n        Statistics=[\"Sum\"],\n    )\n\n    sum_and_timestamps = [(datapoint[\"Sum\"], datapoint[\"Timestamp\"]) for datapoint in response[\"Datapoints\"]]\n    sum_and_timestamps = sorted(sum_and_timestamps, key=lambda x: x[1])\n\n    return sum_and_timestamps", "code_hash": "522b6d116f65d0bd9eda60a1c19153a2", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "kqZH", "name": "_"}, {"code": "pprint(get_metric_sum(\"async_throttled\", \"Throttles\"))", "code_hash": "c19725c9f5816cac7ed88b19e5bb3067", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "wAgl", "name": "_"}, {"code": "mo.md(r\"\"\"\nNope.\n\nIt seems that for throttling due to zero reserved concurrency,\nnothing is published to the `Throttles` metric.\nSo we can't use it to check retries.\n\nWhat to do?\nI found a helpful aws blog post [2].\nIt describes async-specific metrics, including:\n  - `AsyncEventsReceived`, which counts the number of events for this function which arrived in Lambda's internal queue, and\n  - `AsyncEventsDropped`, which counts the number of events dropped because of processing failures.\n\nLet's try them.\n\"\"\")", "code_hash": "d668c6a7193d38633b65ddea62f7f44e", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "rEll", "name": "_"}, {"code": "async_events_received = get_metric_sum(\"async_throttled\", \"AsyncEventsReceived\")\npprint(async_events_received)\n\nasync_events_dropped = get_metric_sum(\"async_throttled\", \"AsyncEventsDropped\")\npprint(async_events_dropped)", "code_hash": "7239a6a609845354f7691c9906fddab0", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "dGlV", "name": "_"}, {"code": "mo.md(r\"\"\"\nSo the event was received and immediately dropped.\n\nConclusion: no retries for functions with zero reserved concurrency.\n\nThat is mentioned in the blog post, though I haven't found it in the main aws docs.\n\"\"\")", "code_hash": "de43ea1d210080fd853f85da0baa6b20", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "SdmI", "name": "_"}, {"code": "mo.md(r\"\"\"\nBut what about retries for _genuine_ throttles?\nThat's what we really care about.\nHow to investigate that?\n\nStrategy:\nSet the reserved concurrency to 1,\nthen invoke the function twice in quick succession.\nThe first invocation will succeed.\nThe handler will sleep for 60s.\nThe second invocation will be throttled,\nas will its retries, for 60s,\nand we can check retries in that window.\n\nIt won't show us retries outside 60s, but it'll be something.\n\nHere we go.\n\"\"\")", "code_hash": "f706879af907f06cacd12e9ec5bd34c2", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "lgWD", "name": "_"}, {"code": "lambda_.put_function_concurrency(FunctionName=\"async_throttled\", ReservedConcurrentExecutions=1)", "code_hash": "ba4f21b3974039bfb823832e2ff44563", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "yOPj", "name": "_"}, {"code": "mo.md(r\"\"\"\nThe first time I tried this,\nI got an `InvalidParameterValueException`.\nThe message complained that the operation was forbidden\nbecause it would reduce my account's `UnreservedConcurrentExecution` below the minimum value of 100.\nDoes that mean my account concurrency was 101?\nIsn't the default 1000?\n\nI found a blog post explaining the situation [3].\nIt turns out that for newish accounts, like mine, the default account concurrency is 10.\nYes, 10.\nBut aws only lets you set a function's reserved concurrency if\nyou're setting it to 0 (like we did above)\nor the leftover concurrency would be at least 100.\n\nWhat to do?\nI could have:\nUnset reserved concurrency.\nThen invoked the function 11 times in quick succession.\nThe first 10 invocations would succeed.\nThe last would be throttled and we could check retries within 60s.\n\nBut I opted for a simpler approach:\nI asked to up my account concurrency to 1000,\nand waited a few hours for aws to approve it.\n\nNow we can try again.\n\"\"\")", "code_hash": "8160c756d15e01e4df0373aeb8df34c7", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "fwwy", "name": "_"}, {"code": "call_times[\"async_throttled\"] = datetime.datetime.now(datetime.UTC)\nfor _ in range(2):\n    lambda_.invoke(FunctionName=\"async_throttled\", InvocationType=\"Event\")", "code_hash": "20f1d6402267ddfd66fdd7d19b05e497", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "LJZf", "name": "_"}, {"code": "mo.md(r\"\"\"\nWe'll wait a bit to give the metrics a chance to update\n\"\"\")", "code_hash": "d5ee6533e659a8657591f309e921e400", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "urSm", "name": "_"}, {"code": "sleep(2 * 60)", "code_hash": "b721335f1619b08b4b54c092090afd39", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "jxvo", "name": "_"}, {"code": "mo.md(r\"\"\"\nthen check throttles again.\n\"\"\")", "code_hash": "87f602ff180ed4af79e5d87c2873f7af", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "mWxS", "name": "_"}, {"code": "pprint(get_metric_sum(\"async_throttled\", \"Throttles\"))", "code_hash": "c19725c9f5816cac7ed88b19e5bb3067", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "CcZR", "name": "_"}, {"code": "mo.md(r\"\"\"\nNice! We can see that there were a bunch of retries.\n\nBut metrics only have a one-minute resolution.\nSo we can't see in much detail when the retries happened.\n\nMaybe `AsyncEventsReceived` gives a richer picture?\n\"\"\")", "code_hash": "a20fbf4534ab2a412081c3cc1a3b19c6", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "YWSi", "name": "_"}, {"code": "pprint(get_metric_sum(\"async_throttled\", \"AsyncEventsReceived\"))", "code_hash": "5e5553fc9478bf8f207349e61afb94ac", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "zlud", "name": "_"}, {"code": "mo.md(r\"\"\"\nNo.\n`AsyncEventsReceived` only counts an event once, no matter how many retries.\nSo it just counted two events, corresponding to our two invocations.\n\nHowever, the blog post describes another async-specific metric we can use:\n\n\u003E The `AsyncEventAge` metric is a measure of the difference between the time that an event is first enqueued\nin the internal queue and the time the Lambda service invokes the function.\nWith retries, Lambda emits this metric every time it attempts to invoke the function with the event.\nAn increasing value shows retries because of error or throttles.\n\"\"\")", "code_hash": "537560c6cd336c818adbd55c67c951b2", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "tZnO", "name": "_"}, {"code": "def get_async_event_age_metric(function_name: str) -\u003E list:\n    response = cloudwatch.get_metric_statistics(\n        Namespace=\"AWS/Lambda\",\n        MetricName=\"AsyncEventAge\",\n        Dimensions=[{\"Name\": \"FunctionName\", \"Value\": function_name}],\n        StartTime=call_times[function_name],\n        EndTime=datetime.datetime.now(datetime.UTC),\n        Period=60,\n        Statistics=[\"SampleCount\", \"Minimum\", \"Average\", \"Maximum\"],\n    )\n\n    return sorted(response[\"Datapoints\"], key=lambda datapoint: datapoint[\"Timestamp\"])", "code_hash": "7d05003414b127fd8eda3f9499cf5e1d", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "xvXZ", "name": "_"}, {"code": "mo.md(r\"\"\"\n(Why those 4 statistics? We'll see shortly.)\n\nFingers crossed.\n\"\"\")", "code_hash": "1efadd000ebe61714f5f7f9044a96909", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "CLip", "name": "_"}, {"code": "pprint(get_async_event_age_metric(\"async_throttled\"))", "code_hash": "689d6ba57a3077645a17aa1e10e25deb", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "YECM", "name": "_"}, {"code": "mo.md(r\"\"\"\nOk, that's looking better.\n\nWe can see that Lambda is backing off and retrying.\n\nLet's also get the call time and the start times from the logs, then think about what the numbers are telling us.\n\"\"\")", "code_hash": "9ae5f310b4ab0f4305e37bf97f88fea5", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "cEAS", "name": "_"}, {"code": "print(\"boto3 call time:\")\nprint(f\"\\t{call_times['async_throttled']}\")\nprint(\"function invocation times:\")\nfor invocation_time in get_invocations_from_logs(\"async_throttled\"):\n    print(f\"\\t{invocation_time}\")", "code_hash": "a8a2bcf5918ea4668fc514a64d979f4b", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "iXej", "name": "_"}, {"code": "mo.md(r\"\"\"\nWe asynchronously invoked the function twice at about 16:29:33.\nSo two events got enqueued about then.\n\nFocus on the first `AsyncEventAge` datapoint.\nIt shows Lambda first tried to invoke the function 33ms after enqueueing (`'Minimum': 33`).\nThat try was successful, the event was removed from the queue, and the function ran for 60s.\nThe datapoint shows 5 additional tries (`'SampleCount': 6`),\nall for the second event,\nthe last of which was about 17s after enqueueing (`'Maximum`: 16645`).\nWe can't tell exactly when the intermediate tries were,\nbut the numbers (`'Average': 4791`) suggest expanding waits between tries.\n(This is why we fetched all four metrics.)\nThose tries all failed.\n\nThe second datapoint shows Lambda tried again to invoke the function\nabout 33s after enqeueing (`'Minimum': 32790`).\nThat try failed too.\nIt tried yet again about 68s after enqueueing (`'Maximum': 67932`).\nThat try was successful,\nbecause the first run had completed by then,\nand the function re-started at about 16:30:42.\nSo no more datapoints.\n\nIn short:\nfor the throttled invocation\nthere were 6 failed tries in the 60s window\nfollowed by 1 successful try a bit later.\n\nThis matches the docs:\n\n\u003E For throttling errors (429) and system errors (500-series),\n\u003E Lambda returns the event to the queue and attempts to run the function again for up to 6 hours by default.\n\u003E The retry interval increases exponentially from 1 second after the first attempt to a maximum of 5 minutes.\n\nexcept the the docs don't explicitly say what's plain from the numbers:\nthat Lambda uses _jittered_ backoff.\n\nLambda could have successfully tried earlier than 68s after enqueuing.\nThe concurrency was only used up for 60s.\nBut Lambda couldn't know that.\n\"\"\")", "code_hash": "2a84fb53a70c6e72c8fdcf65a6863a2c", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "EJmg", "name": "_"}, {"code": "mo.md(r\"\"\"\n### synchronous, exception\n\"\"\")", "code_hash": "3edd7fc8d418c10f1b23d2067f73e43b", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "UmEG", "name": "_"}, {"code": "mo.md(r\"\"\"\nLambda does not retry failed synchronous invocations,\nwhether it fails from throttling, timeout, exception, whatever.\nHow could it?\nFor a synchronous invocation,\nthe requester gets the function's return value or error in the response,\nand the connection is closed.\nSo if a failed invocation were retried, it's too late to respond.\n\nThe _caller_ may retry\n(whether that's you, or an aws service, or whatever).\nBut Lambda itself does not \u2014 could not sensibly \u2014 retry.\n\nStill, for completeness, let's check.\n\"\"\")", "code_hash": "338fe4afa369fb831dbf9c924c78219a", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "vEBW", "name": "_"}, {"code": "pprint(get_invocations_from_logs(\"sync_handler_raises_exception\"))", "code_hash": "f7ffb2214cae8267f45d4ab481147389", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "kLmu", "name": "_"}, {"code": "mo.md(r\"\"\"\nOne invocation only, as expected.\n\"\"\")", "code_hash": "eb143d4d670230ac333e2abe1faa0634", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "LATu", "name": "_"}, {"code": "mo.md(r\"\"\"\n### synchronous, timeout\n\"\"\")", "code_hash": "50edc899db53810f5724a872b771e24e", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "IpqN", "name": "_"}, {"code": "pprint(get_invocations_from_logs(\"sync_invocation_times_out\"))", "code_hash": "06e168a4469553223fa06798b97081ef", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "dxZZ", "name": "_"}, {"code": "mo.md(r\"\"\"\nDitto.\n\"\"\")", "code_hash": "a10050de3ccd6c4690d2b46ef0c5aef3", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "NHgB", "name": "_"}, {"code": "mo.md(r\"\"\"\n### synchronous, throttled\n\"\"\")", "code_hash": "afc92404499ccdebe20771227e77a97f", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "dlnW", "name": "_"}, {"code": "pprint(get_invocations_from_logs(\"sync_throttled\"))", "code_hash": "d02d8947760064090ae94b9424e9a11f", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "TTti", "name": "_"}, {"code": "mo.md(r\"\"\"\nNo retries.\n\n\nWe saw the same with the asynchronous invocation.\nBut in that case, there _were_ retries for genuine throttles\n(rather than throttles because of zero reserved concurrency).\nIs it the same here?\n\nSurely not, for reasons explained above.\nBut let's confirm anyway.\n\nWe'll set reserved concurrency to 1\nthen synchronously invoke the function twice, like before.\n\nFor a synchronous invocation, the boto3 call blocks until the function returns.\nSo invoking the function twice in a loop won't tell us anything:\nthe second invocation will only happen after the first has completed,\nand both will succeed.\n\nWhat we can do instead is to invoke concurrently, in two threads.\n\"\"\")", "code_hash": "7d67d9df661bb73084e9a66754ee9961", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "RKFZ", "name": "_"}, {"code": "lambda_.put_function_concurrency(FunctionName=\"sync_throttled\", ReservedConcurrentExecutions=1)", "code_hash": "173a064dfa64a08494d3ea6aae38c98f", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "IaQp", "name": "_"}, {"code": "def invoke_and_suppress_throttling_exception():\n    try:\n        lambda_.invoke(FunctionName=\"sync_throttled\", InvocationType=\"RequestResponse\")\n    except botocore.exceptions.ClientError as err:\n        if err.response[\"Error\"][\"Code\"] != \"TooManyRequestsException\":\n            raise err", "code_hash": "485f79f411a88b86fcf0920ee4870ca0", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "IWgg", "name": "_"}, {"code": "# this will run for at least as long as the function runs\nfrom threading import Thread\n\ncall_times[\"sync_throttled\"] = datetime.datetime.now(datetime.UTC)\nthread1 = Thread(target=invoke_and_suppress_throttling_exception)\nthread2 = Thread(target=invoke_and_suppress_throttling_exception)\nthread1.start()\nthread2.start()\nthread1.join()\nthread2.join()", "code_hash": "05d243ba8f4f4cf5d33cd90b93512f01", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "fCoF", "name": "_"}, {"code": "sleep(2 * 60)", "code_hash": "b721335f1619b08b4b54c092090afd39", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "LkGn", "name": "_"}, {"code": "pprint(get_metric_sum(\"sync_throttled\", \"Throttles\"))", "code_hash": "892733b9e647c3a1964a72a39399b47d", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "zVRe", "name": "_"}, {"code": "mo.md(r\"\"\"\nAs expected: 1 throttle, meaning 0 retries.\n\"\"\")", "code_hash": "394e576f40557b320990e22d8c824a44", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "woaO", "name": "_"}, {"code": "mo.md(r\"\"\"\n## Summary\n\"\"\")", "code_hash": "fbee05903c979c0a5eb3bc3523ece590", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "IxwP", "name": "_"}, {"code": "mo.md(r\"\"\"\n|           | **exception or timeout**              | **throttled because zero provisioned concurrency** | **genuine throttle**                                                               |\n|-----------|---------------------------------------|----------------------------------------------------|--------------------------------------------------------------------------------------|\n| **async** | try, ~1m wait, retry, ~2m wait, retry | no retry                                           | capped jittered exponential backoff until timeout\u003Cbr\u003E(typically: cap 5m, timeout 6h) |\n| **sync**  | no retry                              | no retry                                           | no retry                                                                             |\n\"\"\")  # noqa: E501", "code_hash": "751e8948cfc33582370cf88c8afe2f2c", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "HnMC", "name": "_"}, {"code": "mo.md(r\"\"\"\n## References\n\n[1] https://boto3.amazonaws.com/v1/documentation/api/latest/guide/retries.html\n\n[2] https://aws.amazon.com/blogs/compute/introducing-new-asynchronous-invocation-metrics-for-aws-lambda/\n\n[3] https://benellis.cloud/my-lambda-concurrency-applied-quota-is-only-10-but-why\n\n[4] https://docs.aws.amazon.com/lambda/latest/dg/invocation-async-error-handling.html\n\n[5] https://developer.mozilla.org/en-US/docs/Web/HTTP/Reference/Status#successful_responses\n\"\"\")", "code_hash": "50369e2ec65dcc9fd10a830e01ecad9d", "config": {"column": null, "disabled": false, "hide_code": true}, "id": "wadT", "name": "_"}], "metadata": {"marimo_version": "0.17.7"}, "version": "1"},
            "session": {"cells": [{"code_hash": "1d0db38904205bec4d6f6f6a1f6cec3e", "console": [], "id": "Hbol", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "833c385ddd0feb68c6f048aa0ab8c86c", "console": [], "id": "MJUe", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch1 id=\"lambda-retries\"\u003ELambda Retries\u003C/h1\u003E\n\u003Cspan class=\"paragraph\"\u003EWhen a function invocation fails, does the Lambda service retry ?\nHow often, and with what backoff?\nDoes it depend on the invocation type (synchronous or asynchronous) or the failure reason (timeout, exception, throttling)?\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "c09d557a5bfa051f0de06153ff460991", "console": [], "id": "vblA", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch2 id=\"stack\"\u003EStack\u003C/h2\u003E\n\u003Cspan class=\"paragraph\"\u003EA bunch of functions:\u003C/span\u003E\n\u003Cul\u003E\n\u003Cli\u003E\u003Ccode\u003Easync_handler_raises_exception\u003C/code\u003E\u003C/li\u003E\n\u003Cli\u003E\u003Ccode\u003Esync_handler_raises_exception\u003C/code\u003E\u003C/li\u003E\n\u003Cli\u003E\u003Ccode\u003Easync_invocation_times_out\u003C/code\u003E\u003C/li\u003E\n\u003Cli\u003E\u003Ccode\u003Esync_invocation_times_out\u003C/code\u003E\u003C/li\u003E\n\u003Cli\u003E\u003Ccode\u003Easync_throttled\u003C/code\u003E\u003C/li\u003E\n\u003Cli\u003E\u003Ccode\u003Esync_throttled\u003C/code\u003E\u003C/li\u003E\n\u003C/ul\u003E\n\u003Cspan class=\"paragraph\"\u003Eeach doing what its name suggests,\nand a log group for each.\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EThe \u003Ccode\u003Easync*\u003C/code\u003E and \u003Ccode\u003Esync*\u003C/code\u003E prefixes just indicate how I'll call the functions,\nnothing about the functions themselves.\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EI have \u003Ccode\u003Easync\u003C/code\u003E and \u003Ccode\u003Esync\u003C/code\u003E versions\nso I can call them concurrently without getting confused.\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EBy default functions sends logs to an automatically created log group.\nBut that log group is not configurable\n(e.g. you should not set its removal policy).\nSo the docs recommend creating your own and passing it in,\nwhich is what I've done.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "9a772d95030c40122a70312309d3c705", "console": [], "id": "bkHC", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch2 id=\"investigation\"\u003EInvestigation\u003C/h2\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "278169008a7cd6af43503364964f52a8", "console": [], "id": "lEQa", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch3 id=\"set-up-boto3-clients\"\u003ESet up boto3 clients\u003C/h3\u003E\n\u003Cspan class=\"paragraph\"\u003EWe'll use boto3 to invoke and monitor the functions.\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EBut by default boto3 automatically retries for certain errors, such as \u003Ccode\u003EThrottlingException\u003C/code\u003E [1].\nWe don't want boto3 to retry: it would be confusing.\n(Was this function invoked twice because boto3 retried or because Lambda retried?)\nSo let's disable.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "b49c1d77ee2d2cd2d1276de57fea5136", "console": [], "id": "PKri", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "a93b64827a32dbe794a3da1f5476aa9a", "console": [], "id": "Xref", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "7e5c1c987976ad5d5f8a844f84b66aa4", "console": [], "id": "SFPL", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003EThe \u003Ccode\u003Eretries\u003C/code\u003E dictionary accepts\na \u003Ccode\u003Etotal_max_attempts\u003C/code\u003E key, which \u003Cem\u003Eincludes\u003C/em\u003E the initial attempt,\nor a \u003Ccode\u003Emax_attempts\u003C/code\u003E key, which \u003Cem\u003Eexcludes\u003C/em\u003E it.\nConfusing!\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EUsing \"retries\" is always confusing.\nDoes \"third retry\" mean third try or fourth try?\nThrow 0 vs 1-indexing into the mix\n(say you store an array with an item for each try)\nand you're asking for trouble.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "904461ab0b5961c773dd7ba611e0aac5", "console": [], "id": "BYtC", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch3 id=\"throttle\"\u003EThrottle\u003C/h3\u003E\n\u003Cspan class=\"paragraph\"\u003ETwo of the lambdas 've deployed are for checking retries given throttling.\nSo throttle them.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "5b7cc4a65933e5210b4da79bc9e8f75c", "console": [], "id": "RGSE", "outputs": [{"data": {"application/json": "{\"ResponseMetadata\": {\"RequestId\": \"21604ae8-be5d-4307-84ef-5e2a624cc33a\", \"HTTPStatusCode\": 200, \"HTTPHeaders\": {\"date\": \"Fri, 21 Nov 2025 16:24:29 GMT\", \"content-type\": \"application/json\", \"content-length\": \"34\", \"connection\": \"keep-alive\", \"x-amzn-requestid\": \"21604ae8-be5d-4307-84ef-5e2a624cc33a\"}, \"RetryAttempts\": 0}, \"ReservedConcurrentExecutions\": 0}"}, "type": "data"}]}, {"code_hash": "57fe7667516667b80c87d109049771a1", "console": [], "id": "Kclp", "outputs": [{"data": {"application/json": "{\"ResponseMetadata\": {\"RequestId\": \"f45885d0-423d-4bf6-85c2-3f3dba82af68\", \"HTTPStatusCode\": 200, \"HTTPHeaders\": {\"date\": \"Fri, 21 Nov 2025 16:24:29 GMT\", \"content-type\": \"application/json\", \"content-length\": \"34\", \"connection\": \"keep-alive\", \"x-amzn-requestid\": \"f45885d0-423d-4bf6-85c2-3f3dba82af68\"}, \"RetryAttempts\": 0}, \"ReservedConcurrentExecutions\": 0}"}, "type": "data"}]}, {"code_hash": "8d341f50378e5cd5c0925d947c80cee1", "console": [], "id": "emfo", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch3 id=\"invoke-the-functions\"\u003EInvoke the functions\u003C/h3\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "96a576a7669d4a5d73624d3430eb489c", "console": [], "id": "Hstk", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "e58d85f70addb972a27aad7d9c1e0c97", "console": [], "id": "nWHF", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "a241a2b54fd868442adb63ab429c496b", "console": [], "id": "iLit", "outputs": [{"data": {"application/json": "{\"ResponseMetadata\": {\"RequestId\": \"89c8aa36-c6ca-4cf7-8f0d-a580f729536e\", \"HTTPStatusCode\": 202, \"HTTPHeaders\": {\"date\": \"Fri, 21 Nov 2025 16:24:29 GMT\", \"content-length\": \"0\", \"connection\": \"keep-alive\", \"x-amzn-requestid\": \"89c8aa36-c6ca-4cf7-8f0d-a580f729536e\", \"x-amzn-remapped-content-length\": \"0\", \"x-amzn-trace-id\": \"root=1-6920923d-71c66f44561a11097318a447;parent=19c0c9dfb2eb82b5;sampled=0\"}, \"RetryAttempts\": 0}, \"StatusCode\": 202, \"Payload\": \"text/plain:\u003Cbotocore.response.StreamingBody object at 0x108e6c3d0\u003E\"}"}, "type": "data"}]}, {"code_hash": "431109c07c4c953d547ce7cedb90f94e", "console": [], "id": "ZHCJ", "outputs": [{"data": {"application/json": "{\"ResponseMetadata\": {\"RequestId\": \"ce5bd8d6-f001-494a-a033-7adac869e884\", \"HTTPStatusCode\": 202, \"HTTPHeaders\": {\"date\": \"Fri, 21 Nov 2025 16:24:29 GMT\", \"content-length\": \"0\", \"connection\": \"keep-alive\", \"x-amzn-requestid\": \"ce5bd8d6-f001-494a-a033-7adac869e884\", \"x-amzn-remapped-content-length\": \"0\", \"x-amzn-trace-id\": \"root=1-6920923d-3b50a7614c06676c35a770b3;parent=47cae6f722858321;sampled=0\"}, \"RetryAttempts\": 0}, \"StatusCode\": 202, \"Payload\": \"text/plain:\u003Cbotocore.response.StreamingBody object at 0x108e6c9d0\u003E\"}"}, "type": "data"}]}, {"code_hash": "bcb7929b21bc39e140d5d6d229a9ebea", "console": [], "id": "ROlb", "outputs": [{"data": {"application/json": "{\"ResponseMetadata\": {\"RequestId\": \"997da887-e021-4546-a72c-47f3613b1492\", \"HTTPStatusCode\": 202, \"HTTPHeaders\": {\"date\": \"Fri, 21 Nov 2025 16:24:30 GMT\", \"content-length\": \"0\", \"connection\": \"keep-alive\", \"x-amzn-requestid\": \"997da887-e021-4546-a72c-47f3613b1492\", \"x-amzn-remapped-content-length\": \"0\", \"x-amzn-trace-id\": \"root=1-6920923e-6a9fb52c135520384f9906b9;parent=4df96e357f4a6f05;sampled=0\"}, \"RetryAttempts\": 0}, \"StatusCode\": 202, \"Payload\": \"text/plain:\u003Cbotocore.response.StreamingBody object at 0x108e6c5b0\u003E\"}"}, "type": "data"}]}, {"code_hash": "bc2b86c67b9c38cc2d57f191cc4b5644", "console": [], "id": "qnkX", "outputs": [{"data": {"application/json": "{\"ResponseMetadata\": {\"RequestId\": \"401e3304-e294-4a22-87a7-3cc364ef64a5\", \"HTTPStatusCode\": 200, \"HTTPHeaders\": {\"date\": \"Fri, 21 Nov 2025 16:24:30 GMT\", \"content-type\": \"application/json\", \"content-length\": \"191\", \"connection\": \"keep-alive\", \"x-amzn-requestid\": \"401e3304-e294-4a22-87a7-3cc364ef64a5\", \"x-amz-function-error\": \"Unhandled\", \"x-amzn-remapped-content-length\": \"0\", \"x-amz-executed-version\": \"$LATEST\", \"x-amzn-trace-id\": \"Root=1-6920923e-69c600301fee231b09ff01e0;Parent=48e841d2332efd8d;Sampled=0;Lineage=1:df25c00f:0\"}, \"RetryAttempts\": 0}, \"StatusCode\": 200, \"FunctionError\": \"Unhandled\", \"ExecutedVersion\": \"$LATEST\", \"Payload\": \"text/plain:\u003Cbotocore.response.StreamingBody object at 0x108e6cca0\u003E\"}"}, "type": "data"}]}, {"code_hash": "11e0f5f4e978e30b76036fd0a4b9315b", "console": [], "id": "TqIu", "outputs": [{"data": {"application/json": "{\"ResponseMetadata\": {\"RequestId\": \"7fd392d9-cca4-49d7-846e-a1dbe2bf5462\", \"HTTPStatusCode\": 200, \"HTTPHeaders\": {\"date\": \"Fri, 21 Nov 2025 16:24:31 GMT\", \"content-type\": \"application/json\", \"content-length\": \"138\", \"connection\": \"keep-alive\", \"x-amzn-requestid\": \"7fd392d9-cca4-49d7-846e-a1dbe2bf5462\", \"x-amz-function-error\": \"Unhandled\", \"x-amzn-remapped-content-length\": \"0\", \"x-amz-executed-version\": \"$LATEST\", \"x-amzn-trace-id\": \"Root=1-6920923e-1db2fc2456e7e5246b74a325;Parent=675fa1ad5df0c44d;Sampled=0;Lineage=1:cd9cf752:0\"}, \"RetryAttempts\": 0}, \"StatusCode\": 200, \"FunctionError\": \"Unhandled\", \"ExecutedVersion\": \"$LATEST\", \"Payload\": \"text/plain:\u003Cbotocore.response.StreamingBody object at 0x108e6cdf0\u003E\"}"}, "type": "data"}]}, {"code_hash": "07f10da72d8f2210a0c13d61440dd03f", "console": [{"mimetype": "text/plain", "name": "stdout", "text": "{'Error': {'Code': 'TooManyRequestsException', 'Message': 'Rate Exceeded.'},\n 'Reason': 'ReservedFunctionConcurrentInvocationLimitExceeded',\n 'ResponseMetadata': {'HTTPHeaders': {'connection': 'keep-alive',\n                                      'content-length': '103',\n                                      'content-type': 'application/json',\n                                      'date': 'Fri, 21 Nov 2025 16:24:32 GMT',\n                                      'x-amzn-errortype': 'TooManyRequestsException',\n                                      'x-amzn-requestid': '6d5ada18-e5f4-42ea-9c1d-9427fea92bf7'},\n                      'HTTPStatusCode': 429,\n                      'MaxAttemptsReached': True,\n                      'RequestId': '6d5ada18-e5f4-42ea-9c1d-9427fea92bf7',\n                      'RetryAttempts': 0},\n 'Type': 'User',\n 'message': 'Rate Exceeded.'}\n", "type": "stream"}], "id": "Vxnm", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "3477f7dd652cbf481d0beaad2696df44", "console": [], "id": "DnEU", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003EThe sync calls get 200 OK.\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EExcept for \u003Ccode\u003Esync_throttled\u003C/code\u003E,\nwhich throws a \u003Ccode\u003ETooManyRequestsException\u003C/code\u003E\nwith underlying \u003Ccode\u003E'HTTPStatusCode': 429\u003C/code\u003E (TooManyRequests).\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EThe async calls get 202 Accepted:\u003C/span\u003E\n\u003Cblockquote\u003E\n\u003Cspan class=\"paragraph\"\u003EThe request has been received but not yet acted upon.\nIt is noncommittal, since there is no way in HTTP to later send an asynchronous response indicating the outcome of the request.\nIt is intended for cases where another process or server handles the request, or for batch processing. [5]\u003C/span\u003E\n\u003C/blockquote\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "7c9123323aba9c4b7ff367e0cfd78b92", "console": [{"mimetype": "text/plain", "name": "stdout", "text": "{'async_handler_raises_exception': datetime.datetime(2025, 11, 21, 16, 24, 29, 542588, tzinfo=datetime.timezone.utc),\n 'async_invocation_times_out': datetime.datetime(2025, 11, 21, 16, 24, 29, 625088, tzinfo=datetime.timezone.utc),\n 'async_throttled': datetime.datetime(2025, 11, 21, 16, 24, 29, 847428, tzinfo=datetime.timezone.utc),\n 'sync_handler_raises_exception': datetime.datetime(2025, 11, 21, 16, 24, 30, 50317, tzinfo=datetime.timezone.utc),\n 'sync_invocation_times_out': datetime.datetime(2025, 11, 21, 16, 24, 30, 576360, tzinfo=datetime.timezone.utc),\n 'sync_throttled': datetime.datetime(2025, 11, 21, 16, 24, 31, 978284, tzinfo=datetime.timezone.utc)}\n", "type": "stream"}], "id": "ulZA", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "192cf85b85a330661f3e1ab9ce425451", "console": [], "id": "ecfG", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003ELet's wait a while to give Lambda a chance to retry.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "cd42452f1f4981ad502291ef3c9cdbfe", "console": [], "id": "Pvdt", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "575b07d6b89159dccc71ea27bc34ab25", "console": [], "id": "ZBYS", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "e889f7e31324aa8301a4cd64a472c4ca", "console": [], "id": "aLJB", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003EI'll be using the logs to find function invocations,\nsince logs have high resolution timestamps.\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EI'll write a helper for that.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "5d50411e8a86df929020f86fd5eb124c", "console": [], "id": "nHfw", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "ff2eb438c9f82520dfb4c03e0436870f", "console": [], "id": "xXTn", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003ENow let's check retries.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "790415ae57cde6082639b3c163be3140", "console": [], "id": "AjVT", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch3 id=\"asynchronous-errors\"\u003Easynchronous, errors\u003C/h3\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "7d5e7a68c699b75a9ac792b5ca88b1d3", "console": [{"mimetype": "text/plain", "name": "stdout", "text": "call time: 2025-11-21 16:24:29.542588+00:00\n", "type": "stream"}, {"mimetype": "text/plain", "name": "stdout", "text": "[datetime.datetime(2025, 11, 21, 16, 24, 29, 906000, tzinfo=datetime.timezone.utc),\n datetime.datetime(2025, 11, 21, 16, 25, 36, 90000, tzinfo=datetime.timezone.utc),\n datetime.datetime(2025, 11, 21, 16, 27, 46, 289000, tzinfo=datetime.timezone.utc)]\n", "type": "stream"}], "id": "pHFh", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "28d47e9bc5acd7496a45e76caff5bd23", "console": [], "id": "NCOB", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003EThe first invocation was a moment after the boto3 call.\nThat makes sense: the function has to init first.\nThe second invocation was about 1 minute later.\nThe third was about 2 minutes after that.\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EThis matches the docs [4]:\u003C/span\u003E\n\u003Cblockquote\u003E\n\u003Cspan class=\"paragraph\"\u003EIf the function returns an error,\nby default Lambda attempts to run it two more times, \nwith a one-minute wait between the first two attempts, \nand two minutes between the second and third attempts\u003C/span\u003E\n\u003C/blockquote\u003E\n\u003Cspan class=\"paragraph\"\u003Eexcept the waits are only \u003Cem\u003Eapproximately\u003C/em\u003E one and two minutes.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "db5a76c93821434ffd3fd15788326af2", "console": [], "id": "aqbW", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch3 id=\"async-times-out\"\u003Easync, times out\u003C/h3\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "f0aa1142e72e4da2fd9bf84120990ac0", "console": [{"mimetype": "text/plain", "name": "stdout", "text": "call time: 2025-11-21 16:24:29.625088+00:00\n", "type": "stream"}, {"mimetype": "text/plain", "name": "stdout", "text": "[datetime.datetime(2025, 11, 21, 16, 24, 30, 142000, tzinfo=datetime.timezone.utc),\n datetime.datetime(2025, 11, 21, 16, 25, 35, 383000, tzinfo=datetime.timezone.utc),\n datetime.datetime(2025, 11, 21, 16, 27, 41, 598000, tzinfo=datetime.timezone.utc)]\n", "type": "stream"}], "id": "TRpd", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "2bea735e6a4948eb5fbffb639f37911d", "console": [], "id": "TXez", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003ESame as for error:\ntry,\nabout 1 minute wait,\ntry,\nabout 2 minute wait,\ntry.\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EThis matches the docs too:\u003C/span\u003E\n\u003Cblockquote\u003E\n\u003Cspan class=\"paragraph\"\u003EFunction errors include errors returned by the function's code and errors returned by the function's runtime, such as timeouts.\u003C/span\u003E\n\u003C/blockquote\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "f7cf52da009c6edd168bf0ccf2202c85", "console": [], "id": "dNNg", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch3 id=\"async-throttled\"\u003Easync, throttled\u003C/h3\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "8c601dfd8b6361d40ace0357b8ce2475", "console": [{"mimetype": "text/plain", "name": "stdout", "text": "call time: 2025-11-21 16:24:29.847428+00:00\n", "type": "stream"}, {"mimetype": "text/plain", "name": "stdout", "text": "[]\n", "type": "stream"}], "id": "yCnT", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "c428b6a915d17c054b3bd0105588accf", "console": [], "id": "wlCL", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003EThat makes sense: it's throttled so no invocations so no logs.\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003ECan we use the \u003Ccode\u003EThrottles\u003C/code\u003E metric instead?\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "522b6d116f65d0bd9eda60a1c19153a2", "console": [], "id": "kqZH", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "c19725c9f5816cac7ed88b19e5bb3067", "console": [{"mimetype": "text/plain", "name": "stdout", "text": "[]\n", "type": "stream"}], "id": "wAgl", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "d668c6a7193d38633b65ddea62f7f44e", "console": [], "id": "rEll", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003ENope.\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EIt seems that for throttling due to zero reserved concurrency,\nnothing is published to the \u003Ccode\u003EThrottles\u003C/code\u003E metric.\nSo we can't use it to check retries.\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EWhat to do?\nI found a helpful aws blog post [2].\nIt describes async-specific metrics, including:\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003E- \u003Ccode\u003EAsyncEventsReceived\u003C/code\u003E, which counts the number of events for this function which arrived in Lambda's internal queue, and\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003E- \u003Ccode\u003EAsyncEventsDropped\u003C/code\u003E, which counts the number of events dropped because of processing failures.\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003ELet's try them.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "7239a6a609845354f7691c9906fddab0", "console": [{"mimetype": "text/plain", "name": "stdout", "text": "[(1.0, datetime.datetime(2025, 11, 21, 16, 24, tzinfo=tzutc()))]\n", "type": "stream"}, {"mimetype": "text/plain", "name": "stdout", "text": "[(1.0, datetime.datetime(2025, 11, 21, 16, 24, tzinfo=tzutc()))]\n", "type": "stream"}], "id": "dGlV", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "de43ea1d210080fd853f85da0baa6b20", "console": [], "id": "SdmI", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003ESo the event was received and immediately dropped.\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EConclusion: no retries for functions with zero reserved concurrency.\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EThat is mentioned in the blog post, though I haven't found it in the main aws docs.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "f706879af907f06cacd12e9ec5bd34c2", "console": [], "id": "lgWD", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003EBut what about retries for \u003Cem\u003Egenuine\u003C/em\u003E throttles?\nThat's what we really care about.\nHow to investigate that?\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EStrategy:\nSet the reserved concurrency to 1,\nthen invoke the function twice in quick succession.\nThe first invocation will succeed.\nThe handler will sleep for 60s.\nThe second invocation will be throttled,\nas will its retries, for 60s,\nand we can check retries in that window.\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EIt won't show us retries outside 60s, but it'll be something.\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EHere we go.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "ba4f21b3974039bfb823832e2ff44563", "console": [], "id": "yOPj", "outputs": [{"data": {"application/json": "{\"ResponseMetadata\": {\"RequestId\": \"6ecaaee8-5190-4c91-83b1-47d273d98445\", \"HTTPStatusCode\": 200, \"HTTPHeaders\": {\"date\": \"Fri, 21 Nov 2025 16:29:33 GMT\", \"content-type\": \"application/json\", \"content-length\": \"34\", \"connection\": \"keep-alive\", \"x-amzn-requestid\": \"6ecaaee8-5190-4c91-83b1-47d273d98445\"}, \"RetryAttempts\": 0}, \"ReservedConcurrentExecutions\": 1}"}, "type": "data"}]}, {"code_hash": "8160c756d15e01e4df0373aeb8df34c7", "console": [], "id": "fwwy", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003EThe first time I tried this,\nI got an \u003Ccode\u003EInvalidParameterValueException\u003C/code\u003E.\nThe message complained that the operation was forbidden\nbecause it would reduce my account's \u003Ccode\u003EUnreservedConcurrentExecution\u003C/code\u003E below the minimum value of 100.\nDoes that mean my account concurrency was 101?\nIsn't the default 1000?\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EI found a blog post explaining the situation [3].\nIt turns out that for newish accounts, like mine, the default account concurrency is 10.\nYes, 10.\nBut aws only lets you set a function's reserved concurrency if\nyou're setting it to 0 (like we did above)\nor the leftover concurrency would be at least 100.\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EWhat to do?\nI could have:\nUnset reserved concurrency.\nThen invoked the function 11 times in quick succession.\nThe first 10 invocations would succeed.\nThe last would be throttled and we could check retries within 60s.\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EBut I opted for a simpler approach:\nI asked to up my account concurrency to 1000,\nand waited a few hours for aws to approve it.\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003ENow we can try again.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "20f1d6402267ddfd66fdd7d19b05e497", "console": [], "id": "LJZf", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "d5ee6533e659a8657591f309e921e400", "console": [], "id": "urSm", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003EWe'll wait a bit to give the metrics a chance to update\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "b721335f1619b08b4b54c092090afd39", "console": [], "id": "jxvo", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "87f602ff180ed4af79e5d87c2873f7af", "console": [], "id": "mWxS", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003Ethen check throttles again.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "c19725c9f5816cac7ed88b19e5bb3067", "console": [{"mimetype": "text/plain", "name": "stdout", "text": "[(5.0, datetime.datetime(2025, 11, 21, 16, 29, tzinfo=tzutc())),\n (1.0, datetime.datetime(2025, 11, 21, 16, 30, tzinfo=tzutc()))]\n", "type": "stream"}], "id": "CcZR", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "a20fbf4534ab2a412081c3cc1a3b19c6", "console": [], "id": "YWSi", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003ENice! We can see that there were a bunch of retries.\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EBut metrics only have a one-minute resolution.\nSo we can't see in much detail when the retries happened.\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EMaybe \u003Ccode\u003EAsyncEventsReceived\u003C/code\u003E gives a richer picture?\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "5e5553fc9478bf8f207349e61afb94ac", "console": [{"mimetype": "text/plain", "name": "stdout", "text": "[(2.0, datetime.datetime(2025, 11, 21, 16, 29, tzinfo=tzutc()))]\n", "type": "stream"}], "id": "zlud", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "537560c6cd336c818adbd55c67c951b2", "console": [], "id": "tZnO", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003ENo.\n\u003Ccode\u003EAsyncEventsReceived\u003C/code\u003E only counts an event once, no matter how many retries.\nSo it just counted two events, corresponding to our two invocations.\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EHowever, the blog post describes another async-specific metric we can use:\u003C/span\u003E\n\u003Cblockquote\u003E\n\u003Cspan class=\"paragraph\"\u003EThe \u003Ccode\u003EAsyncEventAge\u003C/code\u003E metric is a measure of the difference between the time that an event is first enqueued\nin the internal queue and the time the Lambda service invokes the function.\nWith retries, Lambda emits this metric every time it attempts to invoke the function with the event.\nAn increasing value shows retries because of error or throttles.\u003C/span\u003E\n\u003C/blockquote\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "7d05003414b127fd8eda3f9499cf5e1d", "console": [], "id": "xvXZ", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "1efadd000ebe61714f5f7f9044a96909", "console": [], "id": "CLip", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003E(Why those 4 statistics? We'll see shortly.)\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EFingers crossed.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "689d6ba57a3077645a17aa1e10e25deb", "console": [{"mimetype": "text/plain", "name": "stdout", "text": "[{'Average': 4791.833333333333,\n  'Maximum': 16645.0,\n  'Minimum': 33.0,\n  'SampleCount': 6.0,\n  'Timestamp': datetime.datetime(2025, 11, 21, 16, 29, tzinfo=tzutc()),\n  'Unit': 'Milliseconds'},\n {'Average': 50361.0,\n  'Maximum': 67932.0,\n  'Minimum': 32790.0,\n  'SampleCount': 2.0,\n  'Timestamp': datetime.datetime(2025, 11, 21, 16, 30, tzinfo=tzutc()),\n  'Unit': 'Milliseconds'}]\n", "type": "stream"}], "id": "YECM", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "9ae5f310b4ab0f4305e37bf97f88fea5", "console": [], "id": "cEAS", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003EOk, that's looking better.\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EWe can see that Lambda is backing off and retrying.\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003ELet's also get the call time and the start times from the logs, then think about what the numbers are telling us.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "a8a2bcf5918ea4668fc514a64d979f4b", "console": [{"mimetype": "text/plain", "name": "stdout", "text": "boto3 call time:\n\t2025-11-21 16:29:33.770989+00:00\nfunction invocation times:\n", "type": "stream"}, {"mimetype": "text/plain", "name": "stdout", "text": "\t2025-11-21 16:29:34.221000+00:00\n\t2025-11-21 16:30:42.025000+00:00\n", "type": "stream"}], "id": "iXej", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "2a84fb53a70c6e72c8fdcf65a6863a2c", "console": [], "id": "EJmg", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003EWe asynchronously invoked the function twice at about 16:29:33.\nSo two events got enqueued about then.\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EFocus on the first \u003Ccode\u003EAsyncEventAge\u003C/code\u003E datapoint.\nIt shows Lambda first tried to invoke the function 33ms after enqueueing (\u003Ccode\u003E'Minimum': 33\u003C/code\u003E).\nThat try was successful, the event was removed from the queue, and the function ran for 60s.\nThe datapoint shows 5 additional tries (\u003Ccode\u003E'SampleCount': 6\u003C/code\u003E),\nall for the second event,\nthe last of which was about 17s after enqueueing (\u003Ccode\u003E'Maximum\u003C/code\u003E: 16645\u003Ccode\u003E).\nWe can't tell exactly when the intermediate tries were,\nbut the numbers (\u003C/code\u003E'Average': 4791`) suggest expanding waits between tries.\n(This is why we fetched all four metrics.)\nThose tries all failed.\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EThe second datapoint shows Lambda tried again to invoke the function\nabout 33s after enqeueing (\u003Ccode\u003E'Minimum': 32790\u003C/code\u003E).\nThat try failed too.\nIt tried yet again about 68s after enqueueing (\u003Ccode\u003E'Maximum': 67932\u003C/code\u003E).\nThat try was successful,\nbecause the first run had completed by then,\nand the function re-started at about 16:30:42.\nSo no more datapoints.\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EIn short:\nfor the throttled invocation\nthere were 6 failed tries in the 60s window\nfollowed by 1 successful try a bit later.\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EThis matches the docs:\u003C/span\u003E\n\u003Cblockquote\u003E\n\u003Cspan class=\"paragraph\"\u003EFor throttling errors (429) and system errors (500-series),\nLambda returns the event to the queue and attempts to run the function again for up to 6 hours by default.\nThe retry interval increases exponentially from 1 second after the first attempt to a maximum of 5 minutes.\u003C/span\u003E\n\u003C/blockquote\u003E\n\u003Cspan class=\"paragraph\"\u003Eexcept the the docs don't explicitly say what's plain from the numbers:\nthat Lambda uses \u003Cem\u003Ejittered\u003C/em\u003E backoff.\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003ELambda could have successfully tried earlier than 68s after enqueuing.\nThe concurrency was only used up for 60s.\nBut Lambda couldn't know that.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "3edd7fc8d418c10f1b23d2067f73e43b", "console": [], "id": "UmEG", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch3 id=\"synchronous-exception\"\u003Esynchronous, exception\u003C/h3\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "338fe4afa369fb831dbf9c924c78219a", "console": [], "id": "vEBW", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003ELambda does not retry failed synchronous invocations,\nwhether it fails from throttling, timeout, exception, whatever.\nHow could it?\nFor a synchronous invocation,\nthe requester gets the function's return value or error in the response,\nand the connection is closed.\nSo if a failed invocation were retried, it's too late to respond.\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EThe \u003Cem\u003Ecaller\u003C/em\u003E may retry\n(whether that's you, or an aws service, or whatever).\nBut Lambda itself does not \u2014 could not sensibly \u2014 retry.\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EStill, for completeness, let's check.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "f7ffb2214cae8267f45d4ab481147389", "console": [{"mimetype": "text/plain", "name": "stdout", "text": "[datetime.datetime(2025, 11, 21, 16, 24, 30, 500000, tzinfo=datetime.timezone.utc)]\n", "type": "stream"}], "id": "kLmu", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "eb143d4d670230ac333e2abe1faa0634", "console": [], "id": "LATu", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003EOne invocation only, as expected.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "50edc899db53810f5724a872b771e24e", "console": [], "id": "IpqN", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch3 id=\"synchronous-timeout\"\u003Esynchronous, timeout\u003C/h3\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "06e168a4469553223fa06798b97081ef", "console": [{"mimetype": "text/plain", "name": "stdout", "text": "[datetime.datetime(2025, 11, 21, 16, 24, 30, 987000, tzinfo=datetime.timezone.utc)]\n", "type": "stream"}], "id": "dxZZ", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "a10050de3ccd6c4690d2b46ef0c5aef3", "console": [], "id": "NHgB", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003EDitto.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "afc92404499ccdebe20771227e77a97f", "console": [], "id": "dlnW", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch3 id=\"synchronous-throttled\"\u003Esynchronous, throttled\u003C/h3\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "d02d8947760064090ae94b9424e9a11f", "console": [{"mimetype": "text/plain", "name": "stdout", "text": "[]\n", "type": "stream"}], "id": "TTti", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "7d67d9df661bb73084e9a66754ee9961", "console": [], "id": "RKFZ", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003ENo retries.\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EWe saw the same with the asynchronous invocation.\nBut in that case, there \u003Cem\u003Ewere\u003C/em\u003E retries for genuine throttles\n(rather than throttles because of zero reserved concurrency).\nIs it the same here?\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003ESurely not, for reasons explained above.\nBut let's confirm anyway.\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EWe'll set reserved concurrency to 1\nthen synchronously invoke the function twice, like before.\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EFor a synchronous invocation, the boto3 call blocks until the function returns.\nSo invoking the function twice in a loop won't tell us anything:\nthe second invocation will only happen after the first has completed,\nand both will succeed.\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EWhat we can do instead is to invoke concurrently, in two threads.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "173a064dfa64a08494d3ea6aae38c98f", "console": [], "id": "IaQp", "outputs": [{"data": {"application/json": "{\"ResponseMetadata\": {\"RequestId\": \"7ff521ab-adb3-4291-9423-8a4e53e82e87\", \"HTTPStatusCode\": 200, \"HTTPHeaders\": {\"date\": \"Fri, 21 Nov 2025 16:31:35 GMT\", \"content-type\": \"application/json\", \"content-length\": \"34\", \"connection\": \"keep-alive\", \"x-amzn-requestid\": \"7ff521ab-adb3-4291-9423-8a4e53e82e87\"}, \"RetryAttempts\": 0}, \"ReservedConcurrentExecutions\": 1}"}, "type": "data"}]}, {"code_hash": "485f79f411a88b86fcf0920ee4870ca0", "console": [], "id": "IWgg", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "05d243ba8f4f4cf5d33cd90b93512f01", "console": [], "id": "fCoF", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "b721335f1619b08b4b54c092090afd39", "console": [], "id": "LkGn", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "892733b9e647c3a1964a72a39399b47d", "console": [{"mimetype": "text/plain", "name": "stdout", "text": "[(1.0, datetime.datetime(2025, 11, 21, 16, 31, tzinfo=tzutc()))]\n", "type": "stream"}], "id": "zVRe", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "394e576f40557b320990e22d8c824a44", "console": [], "id": "woaO", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003EAs expected: 1 throttle, meaning 0 retries.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "fbee05903c979c0a5eb3bc3523ece590", "console": [], "id": "IxwP", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch2 id=\"summary\"\u003ESummary\u003C/h2\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "751e8948cfc33582370cf88c8afe2f2c", "console": [], "id": "HnMC", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ctable\u003E\n\u003Cthead\u003E\n\u003Ctr\u003E\n\u003Cth\u003E\u003C/th\u003E\n\u003Cth\u003E\u003Cstrong\u003Eexception or timeout\u003C/strong\u003E\u003C/th\u003E\n\u003Cth\u003E\u003Cstrong\u003Ethrottled because zero provisioned concurrency\u003C/strong\u003E\u003C/th\u003E\n\u003Cth\u003E\u003Cstrong\u003Egenuine throttle\u003C/strong\u003E\u003C/th\u003E\n\u003C/tr\u003E\n\u003C/thead\u003E\n\u003Ctbody\u003E\n\u003Ctr\u003E\n\u003Ctd\u003E\u003Cstrong\u003Easync\u003C/strong\u003E\u003C/td\u003E\n\u003Ctd\u003Etry, ~1m wait, retry, ~2m wait, retry\u003C/td\u003E\n\u003Ctd\u003Eno retry\u003C/td\u003E\n\u003Ctd\u003Ecapped jittered exponential backoff until timeout\u003Cbr\u003E(typically: cap 5m, timeout 6h)\u003C/td\u003E\n\u003C/tr\u003E\n\u003Ctr\u003E\n\u003Ctd\u003E\u003Cstrong\u003Esync\u003C/strong\u003E\u003C/td\u003E\n\u003Ctd\u003Eno retry\u003C/td\u003E\n\u003Ctd\u003Eno retry\u003C/td\u003E\n\u003Ctd\u003Eno retry\u003C/td\u003E\n\u003C/tr\u003E\n\u003C/tbody\u003E\n\u003C/table\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "50369e2ec65dcc9fd10a830e01ecad9d", "console": [], "id": "wadT", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch2 id=\"references\"\u003EReferences\u003C/h2\u003E\n\u003Cspan class=\"paragraph\"\u003E[1] \u003Ca href=\"https://boto3.amazonaws.com/v1/documentation/api/latest/guide/retries.html\" rel=\"noopener\" target=\"_blank\"\u003Ehttps://boto3.amazonaws.com/v1/documentation/api/latest/guide/retries.html\u003C/a\u003E\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003E[2] \u003Ca href=\"https://aws.amazon.com/blogs/compute/introducing-new-asynchronous-invocation-metrics-for-aws-lambda/\" rel=\"noopener\" target=\"_blank\"\u003Ehttps://aws.amazon.com/blogs/compute/introducing-new-asynchronous-invocation-metrics-for-aws-lambda/\u003C/a\u003E\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003E[3] \u003Ca href=\"https://benellis.cloud/my-lambda-concurrency-applied-quota-is-only-10-but-why\" rel=\"noopener\" target=\"_blank\"\u003Ehttps://benellis.cloud/my-lambda-concurrency-applied-quota-is-only-10-but-why\u003C/a\u003E\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003E[4] \u003Ca href=\"https://docs.aws.amazon.com/lambda/latest/dg/invocation-async-error-handling.html\" rel=\"noopener\" target=\"_blank\"\u003Ehttps://docs.aws.amazon.com/lambda/latest/dg/invocation-async-error-handling.html\u003C/a\u003E\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003E[5] \u003Ca href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Reference/Status#successful_responses\" rel=\"noopener\" target=\"_blank\"\u003Ehttps://developer.mozilla.org/en-US/docs/Web/HTTP/Reference/Status#successful_responses\u003C/a\u003E\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}], "metadata": {"marimo_version": "0.17.7"}, "version": "1"},
            "runtimeConfig": null,
        };
    </script>
  
<marimo-code hidden="">
    import%20marimo%0A%0A__generated_with%20%3D%20%220.17.7%22%0Aapp%20%3D%20marimo.App(width%3D%22medium%22)%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_()%3A%0A%20%20%20%20import%20marimo%20as%20mo%0A%20%20%20%20return%20(mo%2C)%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%20Lambda%20Retries%0A%0A%20%20%20%20When%20a%20function%20invocation%20fails%2C%20does%20the%20Lambda%20service%20retry%20it%3F%0A%20%20%20%20How%20often%2C%20and%20with%20what%20backoff%3F%0A%20%20%20%20Does%20it%20depend%20on%20the%20invocation%20type%20(synchronous%20or%20asynchronous)%20or%20the%20failure%20reason%20(timeout%2C%20exception%2C%20throttling)%3F%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%23%20Stack%0A%0A%20%20%20%20A%20bunch%20of%20functions%3A%0A%0A%20%20%20%20-%20%60async_handler_raises_exception%60%0A%20%20%20%20-%20%60sync_handler_raises_exception%60%0A%20%20%20%20-%20%60async_invocation_times_out%60%0A%20%20%20%20-%20%60sync_invocation_times_out%60%0A%20%20%20%20-%20%60async_throttled%60%0A%20%20%20%20-%20%60sync_throttled%60%0A%0A%20%20%20%20each%20doing%20what%20its%20name%20suggests%2C%0A%20%20%20%20and%20a%20log%20group%20for%20each.%0A%0A%20%20%20%20The%20%60async*%60%20and%20%60sync*%60%20prefixes%20just%20indicate%20how%20I'll%20call%20the%20functions%2C%0A%20%20%20%20nothing%20about%20the%20functions%20themselves.%0A%0A%20%20%20%20I%20have%20%60async%60%20and%20%60sync%60%20versions%0A%20%20%20%20so%20I%20can%20call%20them%20concurrently%20without%20getting%20confused.%0A%0A%20%20%20%20By%20default%20functions%20sends%20logs%20to%20an%20automatically%20created%20log%20group.%0A%20%20%20%20But%20that%20log%20group%20is%20not%20configurable%0A%20%20%20%20(e.g.%20you%20should%20not%20set%20its%20removal%20policy).%0A%20%20%20%20So%20the%20docs%20recommend%20creating%20your%20own%20and%20passing%20it%20in%2C%0A%20%20%20%20which%20is%20what%20I've%20done.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%23%20Investigation%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%23%23%20Set%20up%20boto3%20clients%0A%0A%20%20%20%20We'll%20use%20boto3%20to%20invoke%20and%20monitor%20the%20functions.%0A%0A%20%20%20%20But%20by%20default%20boto3%20automatically%20retries%20for%20certain%20errors%2C%20such%20as%20%60ThrottlingException%60%20%5B1%5D.%0A%20%20%20%20We%20don't%20want%20boto3%20to%20retry%3A%20it%20would%20be%20confusing.%0A%20%20%20%20(Was%20this%20function%20invoked%20twice%20because%20boto3%20retried%20or%20because%20Lambda%20retried%3F)%0A%20%20%20%20So%20let's%20disable.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20import%20boto3%0A%20%20%20%20import%20botocore%0A%20%20%20%20return%20boto3%2C%20botocore%0A%0A%0A%40app.cell%0Adef%20_(boto3%2C%20botocore)%3A%0A%20%20%20%20config%20%3D%20botocore.config.Config(retries%3D%7B%22total_max_attempts%22%3A%201%7D)%0A%20%20%20%20logs%20%3D%20boto3.client(%22logs%22%2C%20config%3Dconfig)%0A%20%20%20%20lambda_%20%3D%20boto3.client(%22lambda%22%2C%20config%3Dconfig)%0A%20%20%20%20cloudwatch%20%3D%20boto3.client(%22cloudwatch%22%2C%20config%3Dconfig)%0A%20%20%20%20return%20cloudwatch%2C%20lambda_%2C%20logs%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20The%20%60retries%60%20dictionary%20accepts%0A%20%20%20%20a%20%60total_max_attempts%60%20key%2C%20which%20_includes_%20the%20initial%20attempt%2C%0A%20%20%20%20or%20a%20%60max_attempts%60%20key%2C%20which%20_excludes_%20it.%0A%20%20%20%20Confusing!%0A%0A%20%20%20%20Using%20%22retries%22%20is%20always%20confusing.%0A%20%20%20%20Does%20%22third%20retry%22%20mean%20third%20try%20or%20fourth%20try%3F%0A%20%20%20%20Throw%200%20vs%201-indexing%20into%20the%20mix%0A%20%20%20%20(say%20you%20store%20an%20array%20with%20an%20item%20for%20each%20try)%0A%20%20%20%20and%20you're%20asking%20for%20trouble.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%23%23%20Throttle%0A%0A%20%20%20%20Two%20of%20the%20lambdas%20are%20for%20checking%20retries%20given%20throttling.%0A%20%20%20%20So%20let's%20throttle%20them.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(lambda_)%3A%0A%20%20%20%20lambda_.put_function_concurrency(%0A%20%20%20%20%20%20%20%20FunctionName%3D%22async_throttled%22%2C%0A%20%20%20%20%20%20%20%20ReservedConcurrentExecutions%3D0%2C%0A%20%20%20%20)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(lambda_)%3A%0A%20%20%20%20lambda_.put_function_concurrency(%0A%20%20%20%20%20%20%20%20FunctionName%3D%22sync_throttled%22%2C%0A%20%20%20%20%20%20%20%20ReservedConcurrentExecutions%3D0%2C%0A%20%20%20%20)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%23%23%20Invoke%20the%20functions%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20import%20datetime%0A%20%20%20%20from%20pprint%20import%20pprint%0A%20%20%20%20return%20datetime%2C%20pprint%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20call_times%20%3D%20%7B%7D%0A%20%20%20%20return%20(call_times%2C)%0A%0A%0A%40app.cell%0Adef%20_(call_times%2C%20datetime%2C%20lambda_)%3A%0A%20%20%20%20call_times%5B%22async_handler_raises_exception%22%5D%20%3D%20datetime.datetime.now(datetime.UTC)%0A%20%20%20%20lambda_.invoke(FunctionName%3D%22async_handler_raises_exception%22%2C%20InvocationType%3D%22Event%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(call_times%2C%20datetime%2C%20lambda_)%3A%0A%20%20%20%20call_times%5B%22async_invocation_times_out%22%5D%20%3D%20datetime.datetime.now(datetime.UTC)%0A%20%20%20%20lambda_.invoke(FunctionName%3D%22async_invocation_times_out%22%2C%20InvocationType%3D%22Event%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(call_times%2C%20datetime%2C%20lambda_)%3A%0A%20%20%20%20call_times%5B%22async_throttled%22%5D%20%3D%20datetime.datetime.now(datetime.UTC)%0A%20%20%20%20%23%20async%20invocation%20so%20we%20don't%20get%20TooManyRequestsException%0A%20%20%20%20lambda_.invoke(FunctionName%3D%22async_throttled%22%2C%20InvocationType%3D%22Event%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(call_times%2C%20datetime%2C%20lambda_)%3A%0A%20%20%20%20call_times%5B%22sync_handler_raises_exception%22%5D%20%3D%20datetime.datetime.now(datetime.UTC)%0A%20%20%20%20lambda_.invoke(FunctionName%3D%22sync_handler_raises_exception%22%2C%20InvocationType%3D%22RequestResponse%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(call_times%2C%20datetime%2C%20lambda_)%3A%0A%20%20%20%20call_times%5B%22sync_invocation_times_out%22%5D%20%3D%20datetime.datetime.now(datetime.UTC)%0A%20%20%20%20lambda_.invoke(FunctionName%3D%22sync_invocation_times_out%22%2C%20InvocationType%3D%22RequestResponse%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(botocore%2C%20call_times%2C%20datetime%2C%20lambda_%2C%20pprint)%3A%0A%20%20%20%20call_times%5B%22sync_throttled%22%5D%20%3D%20datetime.datetime.now(datetime.UTC)%0A%20%20%20%20try%3A%0A%20%20%20%20%20%20%20%20lambda_.invoke(FunctionName%3D%22sync_throttled%22%2C%20InvocationType%3D%22RequestResponse%22)%0A%20%20%20%20except%20botocore.exceptions.ClientError%20as%20err%3A%0A%20%20%20%20%20%20%20%20if%20err.response%5B%22Error%22%5D%5B%22Code%22%5D%20%3D%3D%20%22TooManyRequestsException%22%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20sync%20invocation%20of%20throttled%20lambda%2C%20so%20we%20expect%20to%20get%20TooManyRequestsException%0A%20%20%20%20%20%20%20%20%20%20%20%20pprint(err.response)%0A%20%20%20%20%20%20%20%20else%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20raise%20err%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20The%20sync%20calls%20get%20200%20OK.%0A%0A%20%20%20%20Except%20for%20%60sync_throttled%60%2C%0A%20%20%20%20which%20throws%20a%20%60TooManyRequestsException%60%0A%20%20%20%20with%20underlying%20%60'HTTPStatusCode'%3A%20429%60%20(TooManyRequests).%0A%0A%20%20%20%20The%20async%20calls%20get%20202%20Accepted%3A%0A%0A%20%20%20%20%3E%20The%20request%20has%20been%20received%20but%20not%20yet%20acted%20upon.%0A%20%20%20%20%3E%20It%20is%20noncommittal%2C%20since%20there%20is%20no%20way%20in%20HTTP%20to%20later%20send%20an%20asynchronous%20response%20indicating%20the%20outcome%20of%20the%20request.%0A%20%20%20%20%3E%20It%20is%20intended%20for%20cases%20where%20another%20process%20or%20server%20handles%20the%20request%2C%20or%20for%20batch%20processing.%20%5B5%5D%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(call_times%2C%20pprint)%3A%0A%20%20%20%20pprint(call_times)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20Let's%20wait%20a%20while%20to%20give%20Lambda%20a%20chance%20to%20retry.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20from%20time%20import%20sleep%0A%20%20%20%20return%20(sleep%2C)%0A%0A%0A%40app.cell%0Adef%20_(sleep)%3A%0A%20%20%20%20sleep(5%20*%2060)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20I'll%20be%20using%20the%20logs%20to%20find%20function%20invocations%2C%0A%20%20%20%20since%20logs%20have%20high%20resolution%20timestamps.%0A%0A%20%20%20%20I'll%20write%20a%20helper%20for%20that.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(call_times%2C%20datetime%2C%20logs)%3A%0A%20%20%20%20def%20get_invocations_from_logs(function_name%3A%20str)%20-%3E%20list%5Bfloat%5D%3A%0A%20%20%20%20%20%20%20%20call_timestamp_in_ms%20%3D%20int(call_times%5Bfunction_name%5D.timestamp())%20*%201000%0A%0A%20%20%20%20%20%20%20%20response%20%3D%20logs.filter_log_events(%0A%20%20%20%20%20%20%20%20%20%20%20%20logGroupName%3Df%22%2Faws%2Flambda%2F%7Bfunction_name%7D%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20startTime%3Dcall_timestamp_in_ms%2C%0A%20%20%20%20%20%20%20%20)%0A%0A%20%20%20%20%20%20%20%20invocations%20%3D%20%5B%0A%20%20%20%20%20%20%20%20%20%20%20%20datetime.datetime.fromtimestamp(event%5B%22timestamp%22%5D%20%2F%201000.0%2C%20tz%3Ddatetime.UTC)%0A%20%20%20%20%20%20%20%20%20%20%20%20for%20event%20in%20response%5B%22events%22%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20event%5B%22message%22%5D.startswith(%22START%22)%0A%20%20%20%20%20%20%20%20%5D%0A%20%20%20%20%20%20%20%20invocations%20%3D%20sorted(invocations)%0A%0A%20%20%20%20%20%20%20%20return%20invocations%0A%20%20%20%20return%20(get_invocations_from_logs%2C)%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20Now%20let's%20check%20retries.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%23%23%20asynchronous%2C%20errors%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(call_times%2C%20get_invocations_from_logs%2C%20pprint)%3A%0A%20%20%20%20print(%22call%20time%3A%22%2C%20call_times%5B%22async_handler_raises_exception%22%5D)%0A%20%20%20%20pprint(get_invocations_from_logs(%22async_handler_raises_exception%22))%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20The%20first%20invocation%20was%20a%20moment%20after%20the%20boto3%20call.%0A%20%20%20%20That%20makes%20sense%3A%20the%20function%20has%20to%20init%20first.%0A%20%20%20%20The%20second%20invocation%20was%20about%201%20minute%20later.%0A%20%20%20%20The%20third%20was%20about%202%20minutes%20after%20that.%0A%0A%20%20%20%20This%20matches%20the%20docs%20%5B4%5D%3A%0A%0A%20%20%20%20%3E%20If%20the%20function%20returns%20an%20error%2C%0A%20%20%20%20%3E%20by%20default%20Lambda%20attempts%20to%20run%20it%20two%20more%20times%2C%0A%20%20%20%20%3E%20with%20a%20one-minute%20wait%20between%20the%20first%20two%20attempts%2C%0A%20%20%20%20%3E%20and%20two%20minutes%20between%20the%20second%20and%20third%20attempts%0A%0A%20%20%20%20except%20the%20waits%20are%20only%20_approximately_%20one%20and%20two%20minutes.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%23%23%20async%2C%20times%20out%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(call_times%2C%20get_invocations_from_logs%2C%20pprint)%3A%0A%20%20%20%20print(%22call%20time%3A%22%2C%20call_times%5B%22async_invocation_times_out%22%5D)%0A%20%20%20%20pprint(get_invocations_from_logs(%22async_invocation_times_out%22))%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20Same%20as%20for%20error%3A%0A%20%20%20%20try%2C%0A%20%20%20%20about%201%20minute%20wait%2C%0A%20%20%20%20try%2C%0A%20%20%20%20about%202%20minute%20wait%2C%0A%20%20%20%20try.%0A%0A%20%20%20%20This%20matches%20the%20docs%20too%3A%0A%0A%20%20%20%20%3E%20Function%20errors%20include%20errors%20returned%20by%20the%20function's%20code%20and%20errors%20returned%20by%20the%20function's%20runtime%2C%20such%20as%20timeouts.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%23%23%20async%2C%20throttled%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(call_times%2C%20get_invocations_from_logs%2C%20pprint)%3A%0A%20%20%20%20print(%22call%20time%3A%22%2C%20call_times%5B%22async_throttled%22%5D)%0A%20%20%20%20pprint(get_invocations_from_logs(%22async_throttled%22))%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20That%20makes%20sense%3A%20it's%20throttled%20so%20no%20invocations%20so%20no%20logs.%0A%0A%20%20%20%20Can%20we%20use%20the%20%60Throttles%60%20metric%20instead%3F%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(call_times%2C%20cloudwatch%2C%20datetime)%3A%0A%20%20%20%20def%20get_metric_sum(function_name%3A%20str%2C%20metric_name%3A%20str)%20-%3E%20list%5Btuple%5D%3A%0A%20%20%20%20%20%20%20%20response%20%3D%20cloudwatch.get_metric_statistics(%0A%20%20%20%20%20%20%20%20%20%20%20%20Namespace%3D%22AWS%2FLambda%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20MetricName%3Dmetric_name%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20Dimensions%3D%5B%7B%22Name%22%3A%20%22FunctionName%22%2C%20%22Value%22%3A%20function_name%7D%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20StartTime%3Dcall_times%5Bfunction_name%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20EndTime%3Ddatetime.datetime.now(datetime.UTC)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20Period%3D60%2C%20%20%23%20lowest%20possible%20for%20non-custom%20metrics%0A%20%20%20%20%20%20%20%20%20%20%20%20Statistics%3D%5B%22Sum%22%5D%2C%0A%20%20%20%20%20%20%20%20)%0A%0A%20%20%20%20%20%20%20%20sum_and_timestamps%20%3D%20%5B(datapoint%5B%22Sum%22%5D%2C%20datapoint%5B%22Timestamp%22%5D)%20for%20datapoint%20in%20response%5B%22Datapoints%22%5D%5D%0A%20%20%20%20%20%20%20%20sum_and_timestamps%20%3D%20sorted(sum_and_timestamps%2C%20key%3Dlambda%20x%3A%20x%5B1%5D)%0A%0A%20%20%20%20%20%20%20%20return%20sum_and_timestamps%0A%20%20%20%20return%20(get_metric_sum%2C)%0A%0A%0A%40app.cell%0Adef%20_(get_metric_sum%2C%20pprint)%3A%0A%20%20%20%20pprint(get_metric_sum(%22async_throttled%22%2C%20%22Throttles%22))%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20Nope.%0A%0A%20%20%20%20It%20seems%20that%20for%20throttling%20due%20to%20zero%20reserved%20concurrency%2C%0A%20%20%20%20nothing%20is%20published%20to%20the%20%60Throttles%60%20metric.%0A%20%20%20%20So%20we%20can't%20use%20it%20to%20check%20retries.%0A%0A%20%20%20%20What%20to%20do%3F%0A%20%20%20%20I%20found%20a%20helpful%20aws%20blog%20post%20%5B2%5D.%0A%20%20%20%20It%20describes%20async-specific%20metrics%2C%20including%3A%0A%20%20%20%20%20%20-%20%60AsyncEventsReceived%60%2C%20which%20counts%20the%20number%20of%20events%20for%20this%20function%20which%20arrived%20in%20Lambda's%20internal%20queue%2C%20and%0A%20%20%20%20%20%20-%20%60AsyncEventsDropped%60%2C%20which%20counts%20the%20number%20of%20events%20dropped%20because%20of%20processing%20failures.%0A%0A%20%20%20%20Let's%20try%20them.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(get_metric_sum%2C%20pprint)%3A%0A%20%20%20%20async_events_received%20%3D%20get_metric_sum(%22async_throttled%22%2C%20%22AsyncEventsReceived%22)%0A%20%20%20%20pprint(async_events_received)%0A%0A%20%20%20%20async_events_dropped%20%3D%20get_metric_sum(%22async_throttled%22%2C%20%22AsyncEventsDropped%22)%0A%20%20%20%20pprint(async_events_dropped)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20So%20the%20event%20was%20received%20and%20immediately%20dropped.%0A%0A%20%20%20%20Conclusion%3A%20no%20retries%20for%20functions%20with%20zero%20reserved%20concurrency.%0A%0A%20%20%20%20That%20is%20mentioned%20in%20the%20blog%20post%2C%20though%20I%20haven't%20found%20it%20in%20the%20main%20aws%20docs.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20But%20what%20about%20retries%20for%20_genuine_%20throttles%3F%0A%20%20%20%20That's%20what%20we%20really%20care%20about.%0A%20%20%20%20How%20to%20investigate%20that%3F%0A%0A%20%20%20%20Strategy%3A%0A%20%20%20%20Set%20the%20reserved%20concurrency%20to%201%2C%0A%20%20%20%20then%20invoke%20the%20function%20twice%20in%20quick%20succession.%0A%20%20%20%20The%20first%20invocation%20will%20succeed.%0A%20%20%20%20The%20handler%20will%20sleep%20for%2060s.%0A%20%20%20%20The%20second%20invocation%20will%20be%20throttled%2C%0A%20%20%20%20as%20will%20its%20retries%2C%20for%2060s%2C%0A%20%20%20%20and%20we%20can%20check%20retries%20in%20that%20window.%0A%0A%20%20%20%20It%20won't%20show%20us%20retries%20outside%2060s%2C%20but%20it'll%20be%20something.%0A%0A%20%20%20%20Here%20we%20go.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(lambda_)%3A%0A%20%20%20%20lambda_.put_function_concurrency(FunctionName%3D%22async_throttled%22%2C%20ReservedConcurrentExecutions%3D1)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20The%20first%20time%20I%20tried%20this%2C%0A%20%20%20%20I%20got%20an%20%60InvalidParameterValueException%60.%0A%20%20%20%20The%20message%20complained%20that%20the%20operation%20was%20forbidden%0A%20%20%20%20because%20it%20would%20reduce%20my%20account's%20%60UnreservedConcurrentExecution%60%20below%20the%20minimum%20value%20of%20100.%0A%20%20%20%20Does%20that%20mean%20my%20account%20concurrency%20was%20101%3F%0A%20%20%20%20Isn't%20the%20default%201000%3F%0A%0A%20%20%20%20I%20found%20a%20blog%20post%20explaining%20the%20situation%20%5B3%5D.%0A%20%20%20%20It%20turns%20out%20that%20for%20newish%20accounts%2C%20like%20mine%2C%20the%20default%20account%20concurrency%20is%2010.%0A%20%20%20%20Yes%2C%2010.%0A%20%20%20%20But%20aws%20only%20lets%20you%20set%20a%20function's%20reserved%20concurrency%20if%0A%20%20%20%20you're%20setting%20it%20to%200%20(like%20we%20did%20above)%0A%20%20%20%20or%20the%20leftover%20concurrency%20would%20be%20at%20least%20100.%0A%0A%20%20%20%20What%20to%20do%3F%0A%20%20%20%20I%20could%20have%3A%0A%20%20%20%20Unset%20reserved%20concurrency.%0A%20%20%20%20Then%20invoked%20the%20function%2011%20times%20in%20quick%20succession.%0A%20%20%20%20The%20first%2010%20invocations%20would%20succeed.%0A%20%20%20%20The%20last%20would%20be%20throttled%20and%20we%20could%20check%20retries%20within%2060s.%0A%0A%20%20%20%20But%20I%20opted%20for%20a%20simpler%20approach%3A%0A%20%20%20%20I%20asked%20to%20up%20my%20account%20concurrency%20to%201000%2C%0A%20%20%20%20and%20waited%20a%20few%20hours%20for%20aws%20to%20approve%20it.%0A%0A%20%20%20%20Now%20we%20can%20try%20again.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(call_times%2C%20datetime%2C%20lambda_)%3A%0A%20%20%20%20call_times%5B%22async_throttled%22%5D%20%3D%20datetime.datetime.now(datetime.UTC)%0A%20%20%20%20for%20_%20in%20range(2)%3A%0A%20%20%20%20%20%20%20%20lambda_.invoke(FunctionName%3D%22async_throttled%22%2C%20InvocationType%3D%22Event%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20We'll%20wait%20a%20bit%20to%20give%20the%20metrics%20a%20chance%20to%20update%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(sleep)%3A%0A%20%20%20%20sleep(5%20*%2060)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20then%20check%20throttles%20again.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(get_metric_sum%2C%20pprint)%3A%0A%20%20%20%20pprint(get_metric_sum(%22async_throttled%22%2C%20%22Throttles%22))%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20Nice!%20We%20can%20see%20that%20there%20were%20a%20bunch%20of%20retries.%0A%0A%20%20%20%20But%20metrics%20only%20have%20a%20one-minute%20resolution.%0A%20%20%20%20So%20we%20can't%20see%20in%20much%20detail%20when%20the%20retries%20happened.%0A%0A%20%20%20%20Maybe%20%60AsyncEventsReceived%60%20gives%20a%20richer%20picture%3F%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(get_metric_sum%2C%20pprint)%3A%0A%20%20%20%20pprint(get_metric_sum(%22async_throttled%22%2C%20%22AsyncEventsReceived%22))%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20No.%0A%20%20%20%20%60AsyncEventsReceived%60%20only%20counts%20an%20event%20once%2C%20no%20matter%20how%20many%20retries.%0A%20%20%20%20So%20it%20just%20counted%20two%20events%2C%20corresponding%20to%20our%20two%20invocations.%0A%0A%20%20%20%20However%2C%20the%20blog%20post%20describes%20another%20async-specific%20metric%20we%20can%20use%3A%0A%0A%20%20%20%20%3E%20The%20%60AsyncEventAge%60%20metric%20is%20a%20measure%20of%20the%20difference%20between%20the%20time%20that%20an%20event%20is%20first%20enqueued%0A%20%20%20%20in%20the%20internal%20queue%20and%20the%20time%20the%20Lambda%20service%20invokes%20the%20function.%0A%20%20%20%20With%20retries%2C%20Lambda%20emits%20this%20metric%20every%20time%20it%20attempts%20to%20invoke%20the%20function%20with%20the%20event.%0A%20%20%20%20An%20increasing%20value%20shows%20retries%20because%20of%20error%20or%20throttles.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(call_times%2C%20cloudwatch%2C%20datetime)%3A%0A%20%20%20%20def%20get_async_event_age_metric(function_name%3A%20str)%20-%3E%20list%3A%0A%20%20%20%20%20%20%20%20response%20%3D%20cloudwatch.get_metric_statistics(%0A%20%20%20%20%20%20%20%20%20%20%20%20Namespace%3D%22AWS%2FLambda%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20MetricName%3D%22AsyncEventAge%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20Dimensions%3D%5B%7B%22Name%22%3A%20%22FunctionName%22%2C%20%22Value%22%3A%20function_name%7D%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20StartTime%3Dcall_times%5Bfunction_name%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20EndTime%3Ddatetime.datetime.now(datetime.UTC)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20Period%3D60%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20Statistics%3D%5B%22SampleCount%22%2C%20%22Minimum%22%2C%20%22Average%22%2C%20%22Maximum%22%5D%2C%0A%20%20%20%20%20%20%20%20)%0A%0A%20%20%20%20%20%20%20%20return%20sorted(response%5B%22Datapoints%22%5D%2C%20key%3Dlambda%20datapoint%3A%20datapoint%5B%22Timestamp%22%5D)%0A%20%20%20%20return%20(get_async_event_age_metric%2C)%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20(Why%20those%204%20statistics%3F%20We'll%20see%20shortly.)%0A%0A%20%20%20%20Fingers%20crossed.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(get_async_event_age_metric%2C%20pprint)%3A%0A%20%20%20%20pprint(get_async_event_age_metric(%22async_throttled%22))%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20Ok%2C%20that's%20looking%20better.%0A%0A%20%20%20%20We%20can%20see%20that%20Lambda%20is%20backing%20off%20and%20retrying.%0A%0A%20%20%20%20Let's%20also%20get%20the%20call%20time%20and%20the%20start%20times%20from%20the%20logs%2C%20then%20think%20about%20what%20the%20numbers%20are%20telling%20us.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(call_times%2C%20get_invocations_from_logs)%3A%0A%20%20%20%20print(%22boto3%20call%20time%3A%22)%0A%20%20%20%20print(f%22%5Ct%7Bcall_times%5B'async_throttled'%5D%7D%22)%0A%20%20%20%20print(%22function%20invocation%20times%3A%22)%0A%20%20%20%20for%20invocation_time%20in%20get_invocations_from_logs(%22async_throttled%22)%3A%0A%20%20%20%20%20%20%20%20print(f%22%5Ct%7Binvocation_time%7D%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20We%20asynchronously%20invoked%20the%20function%20twice%20at%20about%2016%3A29%3A33.%0A%20%20%20%20So%20two%20events%20got%20enqueued%20about%20then.%0A%0A%20%20%20%20Focus%20on%20the%20first%20%60AsyncEventAge%60%20datapoint.%0A%20%20%20%20It%20shows%20Lambda%20first%20tried%20to%20invoke%20the%20function%2033ms%20after%20enqueueing%20(%60'Minimum'%3A%2033%60).%0A%20%20%20%20That%20try%20was%20successful%2C%20the%20event%20was%20removed%20from%20the%20queue%2C%20and%20the%20function%20ran%20for%2060s.%0A%20%20%20%20The%20datapoint%20shows%205%20additional%20tries%20(%60'SampleCount'%3A%206%60)%2C%0A%20%20%20%20all%20for%20the%20second%20event%2C%0A%20%20%20%20the%20last%20of%20which%20was%20about%2017s%20after%20enqueueing%20(%60'Maximum%60%3A%2016645%60).%0A%20%20%20%20We%20can't%20tell%20exactly%20when%20the%20intermediate%20tries%20were%2C%0A%20%20%20%20but%20the%20numbers%20(%60'Average'%3A%204791%60)%20suggest%20expanding%20waits%20between%20tries.%0A%20%20%20%20(This%20is%20why%20we%20fetched%20all%20four%20metrics.)%0A%20%20%20%20Those%20tries%20all%20failed.%0A%0A%20%20%20%20The%20second%20datapoint%20shows%20Lambda%20tried%20again%20to%20invoke%20the%20function%0A%20%20%20%20about%2033s%20after%20enqeueing%20(%60'Minimum'%3A%2032790%60).%0A%20%20%20%20That%20try%20failed%20too.%0A%20%20%20%20It%20tried%20yet%20again%20about%2068s%20after%20enqueueing%20(%60'Maximum'%3A%2067932%60).%0A%20%20%20%20That%20try%20was%20successful%2C%0A%20%20%20%20because%20the%20first%20run%20had%20completed%20by%20then%2C%0A%20%20%20%20and%20the%20function%20re-started%20at%20about%2016%3A30%3A42.%0A%20%20%20%20So%20no%20more%20datapoints.%0A%0A%20%20%20%20In%20short%3A%0A%20%20%20%20for%20the%20throttled%20invocation%0A%20%20%20%20there%20were%206%20failed%20tries%20in%20the%2060s%20window%0A%20%20%20%20followed%20by%201%20successful%20try%20a%20bit%20later.%0A%0A%20%20%20%20This%20matches%20the%20docs%3A%0A%0A%20%20%20%20%3E%20For%20throttling%20errors%20(429)%20and%20system%20errors%20(500-series)%2C%0A%20%20%20%20%3E%20Lambda%20returns%20the%20event%20to%20the%20queue%20and%20attempts%20to%20run%20the%20function%20again%20for%20up%20to%206%20hours%20by%20default.%0A%20%20%20%20%3E%20The%20retry%20interval%20increases%20exponentially%20from%201%20second%20after%20the%20first%20attempt%20to%20a%20maximum%20of%205%20minutes.%0A%0A%20%20%20%20except%20the%20the%20docs%20don't%20explicitly%20say%20what's%20plain%20from%20the%20numbers%3A%0A%20%20%20%20that%20Lambda%20uses%20_jittered_%20backoff.%0A%0A%20%20%20%20Lambda%20could%20have%20successfully%20tried%20earlier%20than%2068s%20after%20enqueuing.%0A%20%20%20%20The%20concurrency%20was%20only%20used%20up%20for%2060s.%0A%20%20%20%20But%20Lambda%20couldn't%20know%20that.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%23%23%20synchronous%2C%20exception%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20Lambda%20does%20not%20retry%20failed%20synchronous%20invocations%2C%0A%20%20%20%20whether%20it%20fails%20from%20throttling%2C%20timeout%2C%20exception%2C%20whatever.%0A%20%20%20%20How%20could%20it%3F%0A%20%20%20%20For%20a%20synchronous%20invocation%2C%0A%20%20%20%20the%20requester%20gets%20the%20function's%20return%20value%20or%20error%20in%20the%20response%2C%0A%20%20%20%20and%20the%20connection%20is%20closed.%0A%20%20%20%20So%20if%20a%20failed%20invocation%20were%20retried%2C%20it's%20too%20late%20to%20respond.%0A%0A%20%20%20%20The%20_caller_%20may%20retry%0A%20%20%20%20(whether%20that's%20you%2C%20or%20an%20aws%20service%2C%20or%20whatever).%0A%20%20%20%20But%20Lambda%20itself%20does%20not%20%E2%80%94%20could%20not%20sensibly%20%E2%80%94%20retry.%0A%0A%20%20%20%20Still%2C%20for%20completeness%2C%20let's%20check.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(get_invocations_from_logs%2C%20pprint)%3A%0A%20%20%20%20pprint(get_invocations_from_logs(%22sync_handler_raises_exception%22))%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20One%20invocation%20only%2C%20as%20expected.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%23%23%20synchronous%2C%20timeout%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(get_invocations_from_logs%2C%20pprint)%3A%0A%20%20%20%20pprint(get_invocations_from_logs(%22sync_invocation_times_out%22))%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20Ditto.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%23%23%20synchronous%2C%20throttled%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(get_invocations_from_logs%2C%20pprint)%3A%0A%20%20%20%20pprint(get_invocations_from_logs(%22sync_throttled%22))%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20No%20retries.%0A%0A%20%20%20%20We%20saw%20the%20same%20with%20the%20asynchronous%20invocation.%0A%20%20%20%20But%20in%20that%20case%2C%20there%20_were_%20retries%20for%20genuine%20throttles%0A%20%20%20%20(rather%20than%20throttles%20because%20of%20zero%20reserved%20concurrency).%0A%20%20%20%20Is%20it%20the%20same%20here%3F%0A%0A%20%20%20%20Surely%20not%2C%20for%20reasons%20explained%20above.%0A%20%20%20%20But%20let's%20confirm%20anyway.%0A%0A%20%20%20%20We'll%20set%20reserved%20concurrency%20to%201%0A%20%20%20%20then%20synchronously%20invoke%20the%20function%20twice%2C%20like%20before.%0A%0A%20%20%20%20For%20a%20synchronous%20invocation%2C%20the%20boto3%20call%20blocks%20until%20the%20function%20returns.%0A%20%20%20%20So%20invoking%20the%20function%20twice%20in%20a%20loop%20won't%20tell%20us%20anything%3A%0A%20%20%20%20the%20second%20invocation%20will%20only%20happen%20after%20the%20first%20has%20completed%2C%0A%20%20%20%20and%20both%20will%20succeed.%0A%0A%20%20%20%20What%20we%20can%20do%20instead%20is%20to%20invoke%20concurrently%2C%20in%20two%20threads.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(lambda_)%3A%0A%20%20%20%20lambda_.put_function_concurrency(FunctionName%3D%22sync_throttled%22%2C%20ReservedConcurrentExecutions%3D1)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(botocore%2C%20lambda_)%3A%0A%20%20%20%20def%20invoke_and_suppress_throttling_exception()%3A%0A%20%20%20%20%20%20%20%20try%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20lambda_.invoke(FunctionName%3D%22sync_throttled%22%2C%20InvocationType%3D%22RequestResponse%22)%0A%20%20%20%20%20%20%20%20except%20botocore.exceptions.ClientError%20as%20err%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20err.response%5B%22Error%22%5D%5B%22Code%22%5D%20!%3D%20%22TooManyRequestsException%22%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20raise%20err%0A%20%20%20%20return%20(invoke_and_suppress_throttling_exception%2C)%0A%0A%0A%40app.cell%0Adef%20_(call_times%2C%20datetime%2C%20invoke_and_suppress_throttling_exception)%3A%0A%20%20%20%20%23%20this%20will%20run%20for%20at%20least%20as%20long%20as%20the%20function%20runs%0A%20%20%20%20from%20threading%20import%20Thread%0A%0A%20%20%20%20call_times%5B%22sync_throttled%22%5D%20%3D%20datetime.datetime.now(datetime.UTC)%0A%20%20%20%20thread1%20%3D%20Thread(target%3Dinvoke_and_suppress_throttling_exception)%0A%20%20%20%20thread2%20%3D%20Thread(target%3Dinvoke_and_suppress_throttling_exception)%0A%20%20%20%20thread1.start()%0A%20%20%20%20thread2.start()%0A%20%20%20%20thread1.join()%0A%20%20%20%20thread2.join()%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(sleep)%3A%0A%20%20%20%20sleep(2%20*%2060)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(get_metric_sum%2C%20pprint)%3A%0A%20%20%20%20pprint(get_metric_sum(%22sync_throttled%22%2C%20%22Throttles%22))%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20As%20expected%3A%201%20throttle%2C%20meaning%200%20retries.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%23%20Summary%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%7C%20%20%20%20%20%20%20%20%20%20%20%7C%20**exception%20or%20timeout**%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7C%20**throttled%20because%20zero%20provisioned%20concurrency**%20%7C%20**genuine%20throttle**%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7C%0A%20%20%20%20%7C-----------%7C---------------------------------------%7C----------------------------------------------------%7C--------------------------------------------------------------------------------------%7C%0A%20%20%20%20%7C%20**async**%20%7C%20try%2C%20~1m%20wait%2C%20retry%2C%20~2m%20wait%2C%20retry%20%7C%20no%20retry%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7C%20capped%20jittered%20exponential%20backoff%20until%20timeout%3Cbr%3E(typically%3A%20cap%205m%2C%20timeout%206h)%20%7C%0A%20%20%20%20%7C%20**sync**%20%20%7C%20no%20retry%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7C%20no%20retry%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7C%20no%20retry%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7C%0A%20%20%20%20%22%22%22)%23%20noqa%3A%20E501%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%23%20References%0A%0A%20%20%20%20%5B1%5D%20https%3A%2F%2Fboto3.amazonaws.com%2Fv1%2Fdocumentation%2Fapi%2Flatest%2Fguide%2Fretries.html%0A%0A%20%20%20%20%5B2%5D%20https%3A%2F%2Faws.amazon.com%2Fblogs%2Fcompute%2Fintroducing-new-asynchronous-invocation-metrics-for-aws-lambda%2F%0A%0A%20%20%20%20%5B3%5D%20https%3A%2F%2Fbenellis.cloud%2Fmy-lambda-concurrency-applied-quota-is-only-10-but-why%0A%0A%20%20%20%20%5B4%5D%20https%3A%2F%2Fdocs.aws.amazon.com%2Flambda%2Flatest%2Fdg%2Finvocation-async-error-handling.html%0A%0A%20%20%20%20%5B5%5D%20https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FHTTP%2FReference%2FStatus%23successful_responses%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0Aif%20__name__%20%3D%3D%20%22__main__%22%3A%0A%20%20%20%20app.run()%0A
</marimo-code>

<marimo-code-hash hidden="">bcf6e61957883c32b51ab130be6d9d28</marimo-code-hash>
</body>
</html>
